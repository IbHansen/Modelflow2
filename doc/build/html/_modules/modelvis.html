<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>modelvis &mdash; ModelFlow  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> ModelFlow
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ModelFlow</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Module code</a> &raquo;</li>
      <li>modelvis</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for modelvis</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Fri May 12 11:07:02 2017</span>

<span class="sd">@author: hanseni</span>

<span class="sd">This module creates functions and classes for visualizing results.</span>

<span class="sd"> </span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span> 
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span> 
<span class="kn">import</span> <span class="nn">fnmatch</span> 
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">dates</span>
<span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="k">as</span> <span class="nn">ticker</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>

<span class="kn">import</span> <span class="nn">numpy</span> 

<span class="kn">from</span> <span class="nn">modelhelp</span> <span class="kn">import</span> <span class="n">cutout</span><span class="p">,</span><span class="n">finddec</span>
        
<span class="c1">##%%</span>
<div class="viewcode-block" id="meltdim"><a class="viewcode-back" href="../index.html#modelvis.meltdim">[docs]</a><span class="k">def</span> <span class="nf">meltdim</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;dima&#39;</span><span class="p">,</span><span class="s1">&#39;dimb&#39;</span><span class="p">],</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;Latest&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Melts a wide dataframe the variable names are split to dimensions acording </span>
<span class="sd">    to the list of texts in dims. in variablenames </span>
<span class="sd">    the tall dataframe have a variable name for each dimensions </span>
<span class="sd">    also values and source are introduced ac column names in the dataframe &#39;&#39;&#39;</span> 
    <span class="n">splitstring</span> <span class="o">=</span> <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\|&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;(?P&lt;&#39;</span><span class="o">+</span><span class="n">d</span><span class="o">+</span><span class="s1">&#39;&gt;[A-Z0-9_]*)&#39;</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">])</span>
    <span class="n">melted</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span><span class="s1">&#39;quarter&#39;</span><span class="p">}),</span><span class="n">id_vars</span><span class="o">=</span><span class="s1">&#39;quarter&#39;</span><span class="p">)</span>
    <span class="n">vardf</span> <span class="o">=</span> <span class="p">(</span><span class="n">melted</span>
      <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">)</span>      
      <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">varname</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">df_</span> <span class="p">:</span><span class="n">df_</span><span class="o">.</span><span class="n">variable</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">,</span><span class="s1">&#39;|&#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dims</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>   <span class="c1"># just to make the next step more easy </span>
      <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="k">lambda</span> <span class="n">df_</span> <span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_</span> <span class="p">,</span><span class="n">df_</span><span class="o">.</span><span class="n">varname</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">splitstring</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">vardf</span></div>


<div class="viewcode-block" id="vis"><a class="viewcode-back" href="../index.html#modelvis.vis">[docs]</a><span class="k">class</span> <span class="nc">vis</span><span class="p">():</span>
     <span class="sd">&#39;&#39;&#39; Visualization class. used as a method on a model instance. </span>
<span class="sd">        </span>
<span class="sd">        The purpose is to select variables acording to a pattern, potential with wildcards</span>
<span class="sd">     &#39;&#39;&#39;</span>
     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pat</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">__pat__</span> <span class="o">=</span> <span class="n">pat</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">vlist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__pat__</span><span class="p">)</span>
         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">thisdf</span> <span class="o">=</span> <span class="n">df</span> 
         <span class="k">else</span><span class="p">:</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">thisdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">lastdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">]</span> 
         <span class="k">return</span>

     <span class="k">def</span> <span class="nf">explain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
         <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
             <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
         <span class="k">return</span> 
     
     <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
         <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
             <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
         
     <span class="k">def</span> <span class="nf">dekomp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">dekomp</span><span class="o">.</span><span class="n">cache_clear</span><span class="p">()</span>
         <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
             <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">dekomp</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    
<div class="viewcode-block" id="vis.heat"><a class="viewcode-back" href="../index.html#modelvis.vis.heat">[docs]</a>     <span class="k">def</span> <span class="nf">heat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
         <span class="sd">&#39;&#39;&#39; Displays a heatmap of the resulting dataframe&#39;&#39;&#39;</span>
         
         <span class="n">name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">__pat__</span><span class="p">)</span>
         <span class="n">a</span> <span class="o">=</span> <span class="n">heatshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thisdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_per</span><span class="p">,:]</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
                      <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
         <span class="k">return</span> <span class="n">a</span> </div>
 
<div class="viewcode-block" id="vis.plot"><a class="viewcode-back" href="../index.html#modelvis.vis.plot">[docs]</a>     <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
         <span class="sd">&#39;&#39;&#39; Displays a plot for each of the columns in the resulting dataframe &#39;&#39;&#39;</span>
         
         <span class="n">name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span><span class="s1">&#39;Title&#39;</span><span class="p">)</span>
         <span class="n">a</span> <span class="o">=</span> <span class="n">plotshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thisdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_per</span><span class="p">,:],</span>
                      <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
         <span class="k">return</span> <span class="n">a</span> </div>
     
        
<div class="viewcode-block" id="vis.plot_alt"><a class="viewcode-back" href="../index.html#modelvis.vis.plot_alt">[docs]</a>     <span class="k">def</span> <span class="nf">plot_alt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
         <span class="sd">&#39;&#39;&#39; Displays a plot for each of the columns in the resulting dataframe &#39;&#39;&#39;</span>
         
         <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="s1">&#39;var_description&#39;</span><span class="p">):</span>
                 <span class="n">vtrans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">var_description</span>
         <span class="k">else</span><span class="p">:</span>
                 <span class="n">vtrans</span> <span class="o">=</span> <span class="p">{}</span>
         <span class="n">a</span> <span class="o">=</span> <span class="n">vis_alt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">basedf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_per</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">vtrans</span><span class="p">)</span> <span class="p">,</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">lastdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_per</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">vtrans</span><span class="p">)</span> <span class="p">,</span>
                      <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
         <span class="k">return</span> <span class="n">a</span> </div>
     
<div class="viewcode-block" id="vis.box"><a class="viewcode-back" href="../index.html#modelvis.vis.box">[docs]</a>     <span class="k">def</span> <span class="nf">box</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
             <span class="sd">&#39;&#39;&#39; Displays a boxplot comparing basedf and lastdf &#39;&#39;&#39;</span> 
             <span class="k">return</span> <span class="n">compvis</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="n">pat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__pat__</span><span class="p">)</span><span class="o">.</span><span class="n">box</span><span class="p">()</span></div>
<div class="viewcode-block" id="vis.violin"><a class="viewcode-back" href="../index.html#modelvis.vis.violin">[docs]</a>     <span class="k">def</span> <span class="nf">violin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
             <span class="sd">&#39;&#39;&#39; Displays a violinplot comparing basedf and lastdf &#39;&#39;&#39;</span> 
             <span class="k">return</span> <span class="n">compvis</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="n">pat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__pat__</span><span class="p">)</span><span class="o">.</span><span class="n">violin</span><span class="p">()</span></div>
<div class="viewcode-block" id="vis.swarm"><a class="viewcode-back" href="../index.html#modelvis.vis.swarm">[docs]</a>     <span class="k">def</span> <span class="nf">swarm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
             <span class="sd">&#39;&#39;&#39; Displays a swarmlot comparing basedf and lastdf &#39;&#39;&#39;</span> 
             <span class="k">return</span> <span class="n">compvis</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="n">pat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__pat__</span><span class="p">)</span><span class="o">.</span><span class="n">swarm</span><span class="p">()</span></div>
     
     
     <span class="nd">@property</span>     
     <span class="k">def</span> <span class="nf">df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="sd">&#39;&#39;&#39; Returns the result of this instance as a dataframe&#39;&#39;&#39;</span>
         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_per</span><span class="p">,:]</span>

     <span class="nd">@property</span>
     <span class="k">def</span> <span class="nf">base</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="sd">&#39;&#39;&#39; Returns basedf &#39;&#39;&#39;</span>
         <span class="k">return</span> <span class="n">vis</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="n">df</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">basedf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">],</span><span class="n">pat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__pat__</span><span class="p">)</span>

     <span class="nd">@property</span>
     <span class="k">def</span> <span class="nf">pct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="sd">&#39;&#39;&#39;Returns the pct change&#39;&#39;&#39;</span>
         <span class="k">return</span> <span class="n">vis</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="n">df</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thisdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">(),</span><span class="n">pat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__pat__</span><span class="p">)</span>

     <span class="nd">@property</span>
     <span class="k">def</span> <span class="nf">year_pct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="sd">&#39;&#39;&#39;Returns the pct change over 4 periods (used for quarterly data) &#39;&#39;&#39;</span> 
         <span class="k">return</span> <span class="n">vis</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="n">df</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thisdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">],</span><span class="n">pat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__pat__</span><span class="p">)</span>

     <span class="nd">@property</span>
     <span class="k">def</span> <span class="nf">frml</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="sd">&#39;&#39;&#39;Returns formulas &#39;&#39;&#39;</span>
         <span class="k">def</span> <span class="nf">getfrml</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">l</span><span class="p">):</span>
             <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endogene</span><span class="p">:</span>
                 <span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">allvar</span><span class="p">[</span><span class="n">var</span><span class="p">][</span><span class="s1">&#39;frml&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;  &#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                 <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">:</span><span class="s1">&lt;</span><span class="si">{</span><span class="n">l</span><span class="si">}}</span><span class="s1"> : </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">&#39;</span>
             <span class="k">else</span><span class="p">:</span> 
                 <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">:{</span><span class="n">l</span><span class="si">}}</span><span class="s1"> : Exogenous&#39;</span>
         <span class="n">mlength</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">])</span> 
         <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">getfrml</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">mlength</span><span class="p">)</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
         <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
         
     <span class="nd">@property</span>
     <span class="k">def</span> <span class="nf">des</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="sd">&#39;&#39;&#39;Returns variable descriptions &#39;&#39;&#39;</span>
         <span class="k">def</span> <span class="nf">getdes</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">l</span><span class="p">):</span>
             <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">:</span><span class="s1">&lt;</span><span class="si">{</span><span class="n">l</span><span class="si">}}</span><span class="s1"> : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">var_description</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
         <span class="n">mlength</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">])</span> 

         <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">getdes</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">mlength</span><span class="p">)</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
         <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
          

     <span class="nd">@property</span>
     <span class="k">def</span> <span class="nf">dif</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="sd">&#39;&#39;&#39; Returns the differens between the basedf and lastdf&#39;&#39;&#39;</span>
         <span class="n">difdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisdf</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">basedf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">]</span>
         <span class="k">return</span> <span class="n">vis</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="n">df</span><span class="o">=</span><span class="n">difdf</span><span class="p">,</span><span class="n">pat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__pat__</span><span class="p">)</span>
     
     <span class="nd">@property</span>
     <span class="k">def</span> <span class="nf">difpctlevel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="sd">&#39;&#39;&#39; Returns the differens between the basedf and lastdf&#39;&#39;&#39;</span>
         <span class="n">difdf</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thisdf</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">basedf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">])</span><span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">basedf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">]</span>
         <span class="k">return</span> <span class="n">vis</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="n">df</span><span class="o">=</span><span class="n">difdf</span><span class="p">,</span><span class="n">pat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__pat__</span><span class="p">)</span>
     <span class="nd">@property</span>
     <span class="k">def</span> <span class="nf">difpct</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="sd">&#39;&#39;&#39; Returns the differens between the pct changes in basedf and lastdf&#39;&#39;&#39;</span>
         <span class="n">difdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisdf</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">basedf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span>
         <span class="k">return</span> <span class="n">vis</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="n">df</span><span class="o">=</span><span class="n">difdf</span><span class="p">,</span><span class="n">pat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__pat__</span><span class="p">)</span>
     <span class="nd">@property</span>
     <span class="k">def</span> <span class="nf">print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="sd">&#39;&#39;&#39; prints the current result&#39;&#39;&#39;</span>
         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">thisdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_per</span><span class="p">,:]</span><span class="o">.</span><span class="n">to_string</span><span class="p">())</span>
         <span class="k">return</span> 
     
<div class="viewcode-block" id="vis.__repr__"><a class="viewcode-back" href="../index.html#modelvis.vis.__repr__">[docs]</a>     <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="c1">#         return self.thisdf.loc[self.model.current_per,:].to_string() </span>

         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">in_notebook</span><span class="p">():</span>
           <span class="c1">#  from modelwidget import visshow</span>
            <span class="c1"># visshow(self.model,self.__pat__)</span>
             <span class="k">return</span> <span class="s1">&#39;&#39;</span>
         <span class="k">else</span><span class="p">:</span>     
             <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_per</span><span class="p">,:]</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span> </div>
             
        

<div class="viewcode-block" id="vis._repr_html_"><a class="viewcode-back" href="../index.html#modelvis.vis._repr_html_">[docs]</a>     <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="sd">&#39;&#39;&#39;Displays a nice summary of the results when called in a Jupyter enviorement&#39;&#39;&#39;</span>

         <span class="kn">from</span> <span class="nn">modelwidget</span> <span class="kn">import</span> <span class="n">visshow</span>
         <span class="n">visshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">__pat__</span><span class="p">)</span>
         <span class="k">return</span> <span class="s1">&#39;&#39;</span></div>

         <span class="c1"># return self.model.ibsstyle(self.thisdf.loc[self.model.current_per,:]).to_html(doctype_html=True) </span>


     <span class="c1"># @property</span>
     <span class="c1"># def show(self):</span>
     <span class="c1">#     if self.model.in_notebook():</span>
     <span class="c1">#         display(self.model.ibsstyle(self.thisdf.loc[self.model.current_per,:],transpose=True))</span>
     <span class="c1">#     else:     </span>
     <span class="c1">#         print(self.thisdf.loc[self.model.current_per,:].to_string()) </span>
     <span class="nd">@property</span>
     <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">in_notebook</span><span class="p">():</span>
             <span class="kn">from</span> <span class="nn">modelwidget</span> <span class="kn">import</span> <span class="n">visshow</span>
             <span class="n">visshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">__pat__</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>     
             <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thisdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_per</span><span class="p">,:]</span><span class="o">.</span><span class="n">to_string</span><span class="p">())</span> 

        
     <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
         <span class="sd">&#39;&#39;&#39; Multiply the curent result with other &#39;&#39;&#39;</span>
         <span class="n">muldf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisdf</span> <span class="o">*</span> <span class="n">other</span> 
         <span class="k">return</span> <span class="n">vis</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="n">df</span><span class="o">=</span><span class="n">muldf</span><span class="p">,</span><span class="n">pat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__pat__</span><span class="p">)</span>
     
<div class="viewcode-block" id="vis.rename"><a class="viewcode-back" href="../index.html#modelvis.vis.rename">[docs]</a>     <span class="k">def</span> <span class="nf">rename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
         <span class="sd">&#39;&#39;&#39; rename columns &#39;&#39;&#39;</span>
         <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span>
             <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="s1">&#39;var_description&#39;</span><span class="p">):</span>
                 <span class="n">vtrans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">var_description</span>
             <span class="k">else</span><span class="p">:</span>
                 <span class="n">vtrans</span> <span class="o">=</span> <span class="p">{}</span>
         <span class="k">else</span><span class="p">:</span>
             <span class="n">vtrans</span> <span class="o">=</span> <span class="n">other</span>
         <span class="n">muldf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thisdf</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">vtrans</span><span class="p">)</span> 
         <span class="k">return</span> <span class="n">vis</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="n">df</span><span class="o">=</span><span class="n">muldf</span><span class="p">,</span><span class="n">pat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__pat__</span><span class="p">)</span></div>

<div class="viewcode-block" id="vis.mul"><a class="viewcode-back" href="../index.html#modelvis.vis.mul">[docs]</a>     <span class="k">def</span> <span class="nf">mul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
         <span class="sd">&#39;&#39;&#39; Multiply the curent result with other &#39;&#39;&#39;</span>
         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__mul__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>
     
     <span class="nd">@property</span>
     <span class="k">def</span> <span class="nf">mul100</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="sd">&#39;&#39;&#39;Multiply the current result with 100 &#39;&#39;&#39;</span>
         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__mul__</span><span class="p">(</span><span class="mf">100.0</span><span class="p">)</span> </div>
         
<div class="viewcode-block" id="compvis"><a class="viewcode-back" href="../index.html#modelvis.compvis">[docs]</a><span class="k">class</span> <span class="nc">compvis</span><span class="p">()</span> <span class="p">:</span>
     <span class="sd">&#39;&#39;&#39; Class to compare to runs in boxplots&#39;&#39;&#39;</span> 
     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pat</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
         <span class="sd">&#39;&#39;&#39; Combines basedf and lastdf to one tall dataframe useful for the Seaborn library&#39;&#39;&#39;</span> 
         <span class="bp">self</span><span class="o">.</span><span class="n">model</span>    <span class="o">=</span> <span class="n">model</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">__pat__</span>  <span class="o">=</span> <span class="n">pat</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">names</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">vlist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__pat__</span><span class="p">)</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">lastdf</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">lastdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_per</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">]</span> 
         <span class="bp">self</span><span class="o">.</span><span class="n">basedf</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">basedf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_per</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">]</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">lastmelt</span> <span class="o">=</span> <span class="n">melt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lastdf</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;Scenario&#39;</span><span class="p">)</span> 
         <span class="bp">self</span><span class="o">.</span><span class="n">basemelt</span> <span class="o">=</span> <span class="n">melt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basedf</span> <span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;Base&#39;</span><span class="p">)</span> 
         <span class="bp">self</span><span class="o">.</span><span class="n">melted</span>   <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">lastmelt</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">basemelt</span><span class="p">])</span>
         <span class="k">return</span>
     
<div class="viewcode-block" id="compvis.box"><a class="viewcode-back" href="../index.html#modelvis.compvis.box">[docs]</a>     <span class="k">def</span> <span class="nf">box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> 
        <span class="sd">&#39;&#39;&#39;Displays a boxplot&#39;&#39;&#39;</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">melted</span><span class="p">,</span><span class="n">hue</span><span class="o">=</span><span class="s1">&#39;source&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__pat__</span><span class="p">)</span></div>
<div class="viewcode-block" id="compvis.swarm"><a class="viewcode-back" href="../index.html#modelvis.compvis.swarm">[docs]</a>     <span class="k">def</span> <span class="nf">swarm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> 
        <span class="sd">&#39;&#39;&#39;Displays a swarmplot &#39;&#39;&#39;</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">swarmplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">melted</span><span class="p">,</span><span class="n">hue</span><span class="o">=</span><span class="s1">&#39;source&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__pat__</span><span class="p">)</span></div>
<div class="viewcode-block" id="compvis.violin"><a class="viewcode-back" href="../index.html#modelvis.compvis.violin">[docs]</a>     <span class="k">def</span> <span class="nf">violin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Displays a violinplot&#39;&#39;&#39;</span> 
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">melted</span><span class="p">,</span><span class="n">hue</span><span class="o">=</span><span class="s1">&#39;source&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__pat__</span><span class="p">)</span></div></div>
        
   
<div class="viewcode-block" id="container"><a class="viewcode-back" href="../index.html#modelvis.container">[docs]</a><span class="k">class</span>  <span class="nc">container</span><span class="p">():</span>
     <span class="sd">&#39;&#39;&#39;A container, used if to izualize dataframes without a model&#39;&#39;&#39;</span>
      
     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lastdf</span><span class="p">,</span><span class="n">basedf</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastdf</span> <span class="o">=</span> <span class="n">lastdf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basedf</span> <span class="o">=</span> <span class="n">basedf</span>
        
<div class="viewcode-block" id="container.smpl"><a class="viewcode-back" href="../index.html#modelvis.container.smpl">[docs]</a>     <span class="k">def</span> <span class="nf">smpl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">slut</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">df</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Defines the model.current_per which is used for calculation period/index</span>
<span class="sd">        when no parameters are issues the current current period is returned \n</span>
<span class="sd">        Either none or all parameters have to be provided &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">start</span> <span class="o">==</span><span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">slut</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">istart</span><span class="p">,</span><span class="n">islut</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastdf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">slice_locs</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">slut</span><span class="p">)</span>
            <span class="n">per</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lastdf</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">istart</span><span class="p">:</span><span class="n">islut</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_per</span> <span class="o">=</span>  <span class="n">per</span> 
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_per</span></div>
<div class="viewcode-block" id="container.vlist"><a class="viewcode-back" href="../index.html#modelvis.container.vlist">[docs]</a>     <span class="k">def</span> <span class="nf">vlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pat</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;returns a list of variable matching the pattern&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pat</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
               <span class="n">ipat</span><span class="o">=</span><span class="n">pat</span>
        <span class="k">else</span><span class="p">:</span>
               <span class="n">ipat</span> <span class="o">=</span> <span class="p">[</span><span class="n">pat</span><span class="p">]</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span>  <span class="n">p</span> <span class="ow">in</span> <span class="n">ipat</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">fnmatch</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lastdf</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">upper</span><span class="p">()))]</span>  
        <span class="k">return</span> <span class="n">out</span>    </div></div>


<span class="c1">##%%  </span>
<div class="viewcode-block" id="varvis"><a class="viewcode-back" href="../index.html#modelvis.varvis">[docs]</a><span class="k">class</span> <span class="nc">varvis</span><span class="p">():</span>
     <span class="sd">&#39;&#39;&#39; Visualization class. used as a method on a model instance. </span>
<span class="sd">        </span>
<span class="sd">        The purpose is to select variables acording to a pattern, potential with wildcards</span>
<span class="sd">     &#39;&#39;&#39;</span>
     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="n">var</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">endo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">allvar</span><span class="p">[</span><span class="n">var</span><span class="p">][</span><span class="s1">&#39;endo&#39;</span><span class="p">]</span>

     <span class="k">def</span> <span class="nf">explain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
         <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
         <span class="k">return</span> <span class="n">x</span>
     
     <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
         <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="varvis.tracedep"><a class="viewcode-back" href="../index.html#modelvis.varvis.tracedep">[docs]</a>     <span class="k">def</span> <span class="nf">tracedep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">down</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
       <span class="sd">&#39;&#39;&#39;Trace dependensies of name down to level down&#39;&#39;&#39;</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">,</span><span class="n">down</span><span class="o">=</span><span class="n">down</span><span class="p">,</span><span class="n">up</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
       
<div class="viewcode-block" id="varvis.tracepre"><a class="viewcode-back" href="../index.html#modelvis.varvis.tracepre">[docs]</a>     <span class="k">def</span> <span class="nf">tracepre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">up</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
       <span class="sd">&#39;&#39;&#39;Trace dependensies of name down to level down&#39;&#39;&#39;</span>
       <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">,</span><span class="n">down</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">up</span><span class="o">=</span><span class="n">up</span><span class="p">,</span><span class="n">sink</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


         
     <span class="k">def</span> <span class="nf">dekomp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
         <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lprint&#39;</span><span class="p">,</span><span class="s1">&#39;False&#39;</span><span class="p">):</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">dekomp</span><span class="o">.</span><span class="n">cache_clear</span><span class="p">()</span>
         <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">dekomp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
         <span class="k">return</span> <span class="n">x</span>
     
     <span class="k">def</span> <span class="nf">var_des</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">var</span><span class="p">):</span>
         <span class="n">des</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">var_description</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>
         <span class="k">return</span> <span class="n">des</span> <span class="k">if</span> <span class="n">des</span> <span class="o">!=</span> <span class="n">var</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
         
     <span class="k">def</span> <span class="nf">_showall_old</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">all</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dif</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">last</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">show_all</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">endo</span><span class="p">:</span>
                <span class="n">des_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_eq_des</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">,</span><span class="n">show_all</span><span class="p">)</span>
                <span class="n">out1</span><span class="p">,</span><span class="n">out2</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span>
                <span class="n">out0</span>   <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Endogeneous: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">var_des</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)</span><span class="si">}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">Formular: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">allvar</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">][</span><span class="s2">&quot;frml&quot;</span><span class="p">]</span><span class="si">}</span><span class="se">\n\n</span><span class="si">{</span><span class="n">des_string</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">dif</span><span class="p">:</span>
                        <span class="n">out0</span> <span class="o">=</span> <span class="n">out0</span><span class="o">+</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Values : </span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span> 
                                            
                    <span class="k">if</span> <span class="nb">all</span><span class="p">:</span>
                        <span class="n">out0</span> <span class="o">=</span> <span class="n">out0</span><span class="o">+</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Values : </span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span> 
                        <span class="n">out1</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Input last run: </span><span class="se">\n</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_eq_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)</span><span class="si">}</span><span class="se">\n\n</span><span class="s1">Input base run: </span><span class="se">\n</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_eq_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">,</span><span class="n">last</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="k">elif</span> <span class="n">last</span><span class="p">:</span>
                        <span class="n">out0</span> <span class="o">=</span> <span class="n">out0</span><span class="o">+</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Values : </span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span> 
                        <span class="n">out1</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Input last run: </span><span class="se">\n</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_eq_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="k">if</span> <span class="nb">all</span> <span class="ow">or</span> <span class="n">dif</span><span class="p">:</span>            
                        <span class="n">out2</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Difference for input variables: </span><span class="se">\n</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_eq_dif</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">,</span><span class="nb">filter</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="k">pass</span> 
                <span class="n">out</span><span class="o">=</span><span class="n">out0</span><span class="o">+</span><span class="n">out1</span><span class="o">+</span><span class="n">out2</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">out</span>   <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Exogeneous : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">var_des</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)</span><span class="si">}</span><span class="s1">  </span><span class="se">\n</span><span class="s1"> Values : </span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span> 
            <span class="k">return</span> <span class="n">out</span>
 
     <span class="c1"># def ibsstyle(self,df,dec=2):</span>
     <span class="c1">#     &#39;&#39;&#39; display a dataframe with tooltip&#39;&#39;&#39;</span>
         
     <span class="c1">#     tt = pd.DataFrame([[self.model.var_description[v] for c in df.columns] for v in df.index ],index=df.index,columns=df.columns) </span>
     <span class="c1">#     xdec = f&#39;{dec}&#39;</span>
     <span class="c1">#     result = df.style.format(&#39;{:.&#39;+xdec+&#39;f}&#39;).\</span>
     <span class="c1">#     set_tooltips(tt, props=&#39;visibility: hidden; position: absolute; z-index: 1; border: 1px solid #000066;&#39;</span>
     <span class="c1">#                     &#39;background-color: white; color: #000066; font-size: 0.8em;&#39;</span>
     <span class="c1">#                     &#39;transform: translate(0px, -24px); padding: 0.6em; border-radius: 0.5em;&#39;)</span>
     <span class="c1">#     return result</span>
 
     <span class="k">def</span> <span class="nf">_showall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">all</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dif</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">last</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">show_all</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">SVG</span><span class="p">,</span> <span class="n">display</span><span class="p">,</span> <span class="n">Image</span><span class="p">,</span> <span class="n">IFrame</span><span class="p">,</span> <span class="n">HTML</span><span class="p">,</span> <span class="n">Markdown</span>
 
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">endo</span><span class="p">:</span>
                <span class="n">des_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_eq_des</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">,</span><span class="n">show_all</span><span class="p">)</span>
                <span class="n">out0</span><span class="p">,</span><span class="n">out1</span><span class="p">,</span><span class="n">out2</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Endogeneous: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">var_des</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Formular: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">allvar</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">][</span><span class="s2">&quot;frml&quot;</span><span class="p">]</span><span class="si">}</span><span class="se">\n\n</span><span class="si">{</span><span class="n">des_string</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>                                            
                    <span class="k">if</span> <span class="n">dif</span> <span class="ow">or</span> <span class="nb">all</span> <span class="ow">or</span> <span class="n">last</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Values :&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">dif</span> <span class="ow">or</span> <span class="nb">all</span> <span class="ow">or</span> <span class="n">last</span><span class="p">:</span> <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ibsstyle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)))</span> 
                    <span class="k">if</span>        <span class="nb">all</span> <span class="ow">or</span> <span class="n">last</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Input last run:&#39;</span><span class="p">)</span>
                    <span class="k">if</span>        <span class="nb">all</span> <span class="ow">or</span> <span class="n">last</span><span class="p">:</span> <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ibsstyle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_eq_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)))</span>
                    <span class="k">if</span>        <span class="nb">all</span>        <span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Input base run:&#39;</span><span class="p">)</span>
                    <span class="k">if</span>        <span class="nb">all</span>        <span class="p">:</span> <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ibsstyle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_eq_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">,</span><span class="n">last</span><span class="o">=</span><span class="kc">False</span><span class="p">)))</span>
                    <span class="k">if</span>        <span class="nb">all</span> <span class="ow">or</span> <span class="n">dif</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Difference for input variables&#39;</span><span class="p">)</span>
                    <span class="k">if</span>        <span class="nb">all</span> <span class="ow">or</span> <span class="n">dif</span><span class="p">:</span> <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ibsstyle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_eq_dif</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">,</span><span class="nb">filter</span><span class="o">=</span><span class="kc">False</span><span class="p">)))</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="k">pass</span> 
                <span class="n">out</span><span class="o">=</span><span class="n">out0</span><span class="o">+</span><span class="n">out1</span><span class="o">+</span><span class="n">out2</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">out</span>   <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Exogeneous : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">var_des</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)</span><span class="si">}</span><span class="s1">  </span><span class="se">\n</span><span class="s1"> Values : </span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span> 
            <span class="k">return</span> <span class="n">out</span>
     
    
     <span class="nd">@property</span>
     <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_showall</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
         <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
         <span class="k">return</span> 
     
     <span class="nd">@property</span>
     <span class="k">def</span> <span class="nf">showdif</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_showall</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">dif</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
         <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
         <span class="k">return</span> 
     <span class="nd">@property</span>
     <span class="k">def</span> <span class="nf">frml</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_showall</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">dif</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
         <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
         <span class="k">return</span> 

     
<div class="viewcode-block" id="varvis.__repr__"><a class="viewcode-back" href="../index.html#modelvis.varvis.__repr__">[docs]</a>     <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
             
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_showall</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">last</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">out</span></div></div>
            

        
<div class="viewcode-block" id="vis_alt"><a class="viewcode-back" href="../index.html#modelvis.vis_alt">[docs]</a><span class="k">def</span> <span class="nf">vis_alt</span><span class="p">(</span><span class="n">grund</span><span class="p">,</span><span class="n">mul</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Show variables&#39;</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Graph of one of more variables each variable is displayed for 3 banks&#39;&#39;&#39;</span>
    <span class="n">avar</span> <span class="o">=</span> <span class="n">grund</span><span class="o">.</span><span class="n">columns</span>
    <span class="n">antal</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">avar</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">antal</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="n">antal</span><span class="o">*</span><span class="mi">6</span><span class="p">))</span>  <span class="c1">#,sharex=&#39;col&#39; ,sharey=&#39;row&#39;)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="p">[</span><span class="n">axes</span><span class="p">]</span> <span class="k">if</span> <span class="n">antal</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">axes</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">var</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">avar</span><span class="p">,</span><span class="n">ax2</span><span class="p">)):</span>
        <span class="n">grunddata</span> <span class="o">=</span> <span class="n">grund</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">var</span><span class="p">]</span>
        <span class="n">muldata</span> <span class="o">=</span> <span class="n">mul</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">var</span><span class="p">]</span>
        <span class="c1"># breakpoint() </span>
        <span class="n">grunddata</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">muldata</span><span class="o">.</span><span class="n">plot</span> <span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">x_pos</span> <span class="o">=</span> <span class="n">grunddata</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_pos</span><span class="p">,</span> <span class="n">grunddata</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;Baseline&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_pos</span><span class="p">,</span> <span class="n">muldata</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="p">,</span><span class="s1">&#39;Alternative&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">value</span><span class="p">,</span><span class="n">number</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">,</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">))</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">NullLocator</span><span class="p">())</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span></div>
    

<div class="viewcode-block" id="plotshow"><a class="viewcode-back" href="../index.html#modelvis.plotshow">[docs]</a><span class="k">def</span> <span class="nf">plotshow</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">ppos</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span><span class="n">colrow</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span>
             <span class="n">splitchar</span><span class="o">=</span><span class="s1">&#39;__&#39;</span><span class="p">,</span><span class="n">savefig</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    </span>

<span class="sd">    Args:</span>
<span class="sd">        df (TYPE): Dataframe .</span>
<span class="sd">        name (TYPE, optional): title. Defaults to &#39;&#39;.</span>
<span class="sd">        ppos (TYPE, optional): # of position to use if split. Defaults to -1.</span>
<span class="sd">        kind (TYPE, optional): matplotlib kind . Defaults to &#39;line&#39;.</span>
<span class="sd">        colrow (TYPE, optional): columns per row . Defaults to 6.</span>
<span class="sd">        sharey (TYPE, optional): Share y axis between plots. Defaults to True.</span>
<span class="sd">        top (TYPE, optional): relative position of the title. Defaults to 0.90.</span>
<span class="sd">        splitchar (TYPE, optional): if the name should be split . Defaults to &#39;__&#39;.</span>
<span class="sd">        savefig (TYPE, optional): save figure. Defaults to &#39;&#39;.</span>
<span class="sd">        xsize  (TYPE, optional): x size default to 10 </span>
<span class="sd">        ysize  (TYPE, optional): y size per row, defaults to 2</span>

<span class="sd">    Returns:</span>
<span class="sd">        a matplotlib fig.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="sd">&#39;&#39;&#39; Plots a subplot for each column in a datafra.</span>
<span class="sd">    ppos determins which split by __ to use </span>
<span class="sd">    kind determins which kind of matplotlib chart to use </span>
<span class="sd">     </span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span> 
    <span class="k">if</span> <span class="n">splitchar</span><span class="p">:</span>
        <span class="n">out</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="k">lambda</span> <span class="n">df_</span><span class="p">:</span> <span class="n">df_</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">splitchar</span><span class="p">)[</span><span class="n">ppos</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">df_</span><span class="o">.</span><span class="n">columns</span><span class="p">}))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">out</span><span class="o">=</span><span class="n">df</span>
    <span class="n">number</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> 
    <span class="n">row</span><span class="o">=-</span><span class="p">((</span><span class="o">-</span><span class="n">number</span><span class="p">)</span><span class="o">//</span><span class="n">colrow</span><span class="p">)</span>
    <span class="c1"># breakpoint()</span>
    
    <span class="n">axes</span><span class="o">=</span><span class="n">out</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">layout</span><span class="o">=</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">colrow</span><span class="p">),</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xsize&#39;</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">row</span><span class="o">*</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ysize&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span>
                 <span class="n">use_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="n">sharey</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">():</span>
        <span class="k">pass</span>
        <span class="c1"># dec=finddec(dfatt)</span>
        <span class="c1"># ax.yaxis.set_major_formatter(ticker.FuncFormatter(lambda value,number: f&#39;{value:,}&#39;))</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">NullLocator</span><span class="p">())</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="c1"># top = (row*(2-0.1)-0.2)/(row*(2-0.1))</span>
<span class="c1">#    print(top)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">savefig</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savefig</span><span class="p">)</span>
   <span class="c1"># plt.subplot_tool()</span>
    <span class="k">return</span> <span class="n">fig</span></div>
    
<div class="viewcode-block" id="melt"><a class="viewcode-back" href="../index.html#modelvis.melt">[docs]</a><span class="k">def</span> <span class="nf">melt</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;Latest&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; melts a wide dataframe to a tall dataframe , appends a soruce column &#39;&#39;&#39;</span> 
    <span class="n">melted</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span><span class="s1">&#39;time&#39;</span><span class="p">}),</span><span class="n">id_vars</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">)</span> 
    <span class="k">return</span> <span class="n">melted</span></div>

<div class="viewcode-block" id="heatshow"><a class="viewcode-back" href="../index.html#modelvis.heatshow">[docs]</a><span class="k">def</span> <span class="nf">heatshow</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Reds&quot;</span><span class="p">,</span><span class="n">mul</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span><span class="n">annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mf">11.69</span><span class="p">,</span><span class="mf">8.27</span><span class="p">),</span><span class="n">dec</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">linewidths</span><span class="o">=</span><span class="mf">.5</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; A heatmap of a dataframe &#39;&#39;&#39;</span> 
    <span class="n">xx</span><span class="o">=</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">))</span><span class="o">*</span><span class="n">mul</span> 
<span class="c1">#    fig, ax = plt.subplots(figsize=(11,8))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>  <span class="c1">#A4 </span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;f&quot;</span><span class="p">,</span><span class="n">annot</span><span class="o">=</span><span class="n">annot</span><span class="p">,</span><span class="n">annot_kws</span> <span class="o">=</span><span class="p">{</span><span class="s2">&quot;ha&quot;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">},</span><span class="n">linewidths</span><span class="o">=</span><span class="n">linewidths</span><span class="p">,</span><span class="n">cbar</span><span class="o">=</span><span class="n">cbar</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> 
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_majorticklabels</span><span class="p">(),</span> <span class="n">ha</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">yax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span>
    <span class="n">pad</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">T</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">get_window_extent</span><span class="p">()</span><span class="o">.</span><span class="n">width</span> <span class="k">for</span> <span class="n">T</span> <span class="ow">in</span> <span class="n">yax</span><span class="o">.</span><span class="n">majorTicks</span><span class="p">)</span>
    <span class="n">yax</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_majorticklabels</span><span class="p">(),</span> <span class="n">va</span> <span class="o">=</span> <span class="s1">&#39;top&#39;</span> <span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mf">70.</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.15</span><span class="p">)</span>
    <span class="c1">#ax.tick_paraOms(axis=&#39;y&#39;,direction=&#39;out&#39;, length=3, width=2, colors=&#39;b&#39;,labelleft=True)</span>
    <span class="k">return</span> <span class="n">fig</span></div>
<span class="c1">##%%</span>
<div class="viewcode-block" id="attshow"><a class="viewcode-back" href="../index.html#modelvis.attshow">[docs]</a><span class="k">def</span> <span class="nf">attshow</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">treshold</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">head</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span><span class="n">tail</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">showsum</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mf">11.69</span><span class="p">,</span><span class="mf">8.27</span><span class="p">),</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="n">tshow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">dec</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">cbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span><span class="n">savefig</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Shows heatmap of impacts of exogeneous variables</span>
<span class="sd">    :df: Dataframe with impact </span>
<span class="sd">    :treshold: Take exogeneous variables with max impact of treshold or larger</span>
<span class="sd">    :numhigh: take the numhigh largest impacts</span>
<span class="sd">    :t: transpose the heatmap</span>
<span class="sd">    :annot: Annotate the heatmap</span>
<span class="sd">    :head: take the head largest </span>
<span class="sd">    .tail: take the tail smalest </span>
<span class="sd">    :showsum: Add a column with the sum </span>
<span class="sd">    :sort: Sort the data</span>
<span class="sd">    .tshow: Show a longer title</span>
<span class="sd">    :cbar:  if a colorbar shoud be displayes</span>
<span class="sd">    :cmap: the colormap</span>
<span class="sd">    :save: Save the chart (in png format) &#39;&#39;&#39;</span>
    
    
    <span class="n">selectmin</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="n">tail</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> 
    <span class="n">selectmax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">head</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> 
    <span class="n">select</span><span class="o">=</span><span class="n">selectmax</span><span class="o">+</span><span class="n">selectmin</span>
    <span class="n">yy</span>      <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">select</span><span class="p">]</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">df_</span> <span class="p">:</span> <span class="n">df_</span><span class="p">[</span><span class="n">select</span><span class="p">]</span> <span class="k">if</span> <span class="n">sort</span> <span class="k">else</span> <span class="n">df_</span><span class="p">[</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df_</span><span class="o">.</span><span class="n">columns</span><span class="p">))])</span>
    <span class="k">if</span> <span class="n">showsum</span><span class="p">:</span>
        <span class="n">asum</span><span class="o">=</span> <span class="n">yy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">asum</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;_Sum&#39;</span>
        <span class="n">yy</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">yy</span><span class="p">,</span><span class="n">asum</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
 
    <span class="n">yy2</span> <span class="o">=</span> <span class="n">yy</span><span class="o">.</span><span class="n">T</span> <span class="k">if</span> <span class="n">t</span>  <span class="k">else</span> <span class="n">yy</span>
    <span class="k">if</span> <span class="n">sort</span> <span class="ow">and</span> <span class="n">tshow</span><span class="p">:</span> 
        <span class="n">txt</span><span class="o">=</span> <span class="s1">&#39; Impact from exogeneous variables. &#39;</span><span class="o">+</span><span class="p">(</span>
         <span class="nb">str</span><span class="p">(</span><span class="n">head</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; highest. &#39;</span> <span class="k">if</span> <span class="n">head</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span><span class="n">tail</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; smallest. &#39;</span> <span class="k">if</span> <span class="n">tail</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">txt</span><span class="o">=</span> <span class="s1">&#39;&#39;</span> 
    <span class="n">f</span><span class="o">=</span><span class="n">heatshow</span><span class="p">(</span><span class="n">yy2</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">title</span><span class="o">+</span><span class="n">txt</span> <span class="p">,</span><span class="n">annot</span><span class="o">=</span><span class="n">annot</span><span class="p">,</span><span class="n">mul</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span><span class="n">dec</span><span class="o">=</span><span class="n">dec</span><span class="p">,</span><span class="n">cbar</span><span class="o">=</span><span class="n">cbar</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.16</span><span class="p">)</span> 
    <span class="k">if</span> <span class="n">savefig</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savefig</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">yy2</span></div>



<div class="viewcode-block" id="attshowone"><a class="viewcode-back" href="../index.html#modelvis.attshowone">[docs]</a><span class="k">def</span> <span class="nf">attshowone</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">pre</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">head</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">tail</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; shows the contribution to row=name from each column </span>
<span class="sd">    the coulumns can optional be selected as starting with pre&#39;&#39;&#39;</span>
    
    <span class="n">res</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">name</span><span class="p">,[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">pre</span><span class="p">)]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span>
                   <span class="k">lambda</span> <span class="n">df_</span><span class="p">:</span> <span class="n">df_</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">head</span><span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="n">tail</span><span class="p">)))</span>
    <span class="n">ax</span> <span class="o">=</span>  <span class="n">res</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
    <span class="n">txt</span><span class="o">=</span> <span class="p">(</span> <span class="nb">str</span><span class="p">(</span><span class="n">head</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; highest. &#39;</span> <span class="k">if</span> <span class="n">head</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span><span class="n">tail</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; smallest. &#39;</span> <span class="k">if</span> <span class="n">tail</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Contributions to &#39;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;.   &#39;</span><span class="o">+</span><span class="n">txt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="water"><a class="viewcode-back" href="../index.html#modelvis.water">[docs]</a><span class="k">def</span> <span class="nf">water</span><span class="p">(</span><span class="n">serxinput</span><span class="p">,</span><span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">ascending</span> <span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">autosum</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">allsort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Creates a dataframe with information for a watrfall diagram </span>
<span class="sd">    </span>
<span class="sd">    :serx:  the input serie of values</span>
<span class="sd">    :sort:  True if the bars except the first and last should be sorted (default = False)</span>
<span class="sd">    :allsort:  True if all bars should be sorted (default = False)</span>
<span class="sd">    :autosum:  True if a Total bar are added in the end  </span>
<span class="sd">    :ascending:  True if sortorder = ascending  </span>
<span class="sd">    </span>
<span class="sd">    Returns a dataframe with theese columns:</span>
<span class="sd">    </span>
<span class="sd">    :hbegin: Height of the first bar</span>
<span class="sd">    :hend: Height of the last bar</span>
<span class="sd">    :hpos: Height of positive bars</span>
<span class="sd">    :hneg: Height of negative bars</span>
<span class="sd">    :start: Ofset at which each bar starts </span>
<span class="sd">    :height: Height of each bar (just for information)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># get the height of first and last column </span>
    
   
    <span class="n">total</span><span class="o">=</span><span class="n">serxinput</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> 
    <span class="n">serx</span> <span class="o">=</span> <span class="n">cutout</span><span class="p">(</span><span class="n">serxinput</span><span class="p">,</span><span class="n">threshold</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sort</span> <span class="ow">or</span> <span class="n">allsort</span> <span class="p">:</span>   <span class="c1"># sort rows except the first and last</span>
        <span class="n">endslice</span>   <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">allsort</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">startslice</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">allsort</span> <span class="k">else</span>  <span class="mi">1</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">serx</span><span class="p">[</span><span class="n">startslice</span><span class="p">:</span><span class="n">endslice</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span><span class="n">ascending</span> <span class="p">)</span><span class="o">.</span><span class="n">index</span>
        <span class="k">if</span> <span class="n">allsort</span><span class="p">:</span>            
            <span class="n">newi</span> <span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">newi</span> <span class="o">=</span><span class="p">[</span><span class="n">serx</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span>  <span class="o">+</span> <span class="n">i</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">+</span> <span class="p">[</span><span class="n">serx</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="c1"># Get the head and tail </span>
        <span class="n">ser</span><span class="o">=</span><span class="n">serx</span><span class="p">[</span><span class="n">newi</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ser</span><span class="o">=</span><span class="n">serx</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        
    <span class="k">if</span> <span class="n">autosum</span><span class="p">:</span>
        <span class="n">ser</span><span class="p">[</span><span class="s1">&#39;Total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total</span>
        
    <span class="n">hbegin</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">hbegin</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="n">hend</span>   <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">hend</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
         
    
    <span class="n">height</span> <span class="o">=</span> <span class="n">ser</span> 
    <span class="n">start</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span><span class="o">.</span><span class="n">shift</span><span class="p">()</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>  <span class="c1"># the  starting point for each bar</span>
    <span class="n">start</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">start</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">allsort</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">autosum</span> <span class="k">else</span> <span class="mi">0</span>     <span class="c1"># the last bar should start at 0</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">ser</span>

    <span class="n">hpos</span><span class="o">=</span> <span class="n">height</span><span class="o">*</span><span class="p">(</span><span class="n">height</span><span class="o">&gt;=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">hneg</span><span class="o">=</span> <span class="n">height</span><span class="o">*</span><span class="p">(</span><span class="n">height</span><span class="o">&lt;=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">dfatt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;start&#39;</span><span class="p">:</span><span class="n">start</span><span class="p">,</span><span class="s1">&#39;hbegin&#39;</span><span class="p">:</span><span class="n">hbegin</span><span class="p">,</span><span class="s1">&#39;hpos&#39;</span><span class="p">:</span><span class="n">hpos</span><span class="p">,</span><span class="s1">&#39;hneg&#39;</span><span class="p">:</span><span class="n">hneg</span><span class="p">,</span><span class="s1">&#39;hend&#39;</span><span class="p">:</span><span class="n">hend</span><span class="p">,</span><span class="s1">&#39;height&#39;</span><span class="p">:</span><span class="n">height</span><span class="p">})</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ser</span><span class="o">.</span><span class="n">index</span><span class="p">,:]</span>

    <span class="k">return</span> <span class="n">dfatt</span></div>

<span class="k">def</span> <span class="nf">waterplot</span><span class="p">(</span><span class="n">basis</span><span class="p">,</span><span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">ascending</span> <span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">autosum</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">bartype</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
              <span class="n">allsort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Attribution &#39;</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">desdic</span> <span class="o">=</span> <span class="p">{},</span><span class="n">zero</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="n">ysize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="o">**</span><span class="n">kwarg</span><span class="p">):</span>
    <span class="n">att</span> <span class="o">=</span> <span class="p">[(</span><span class="n">name</span><span class="p">,</span><span class="n">water</span><span class="p">(</span><span class="n">ser</span><span class="p">,</span><span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">,</span><span class="n">autosum</span><span class="o">=</span><span class="n">autosum</span><span class="p">,</span><span class="n">allsort</span><span class="o">=</span><span class="n">allsort</span><span class="p">,</span><span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">))</span> 
                       <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">ser</span> <span class="ow">in</span> <span class="n">basis</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()]</span>
    <span class="c1"># print(att[0][1])</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">att</span><span class="p">),</span><span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="n">ysize</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">att</span><span class="p">)),</span><span class="n">constrained_layout</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># the width of the barsser</span>
    <span class="n">laxis</span> <span class="o">=</span> <span class="n">axis</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">axis</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,((</span><span class="n">name</span><span class="p">,</span><span class="n">dfatt</span><span class="p">),</span><span class="n">ax</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">att</span><span class="p">,</span><span class="n">laxis</span><span class="p">)):</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">dfatt</span><span class="o">.</span><span class="n">hpos</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="n">bartype</span><span class="p">,</span><span class="n">bottom</span><span class="o">=</span><span class="n">dfatt</span><span class="o">.</span><span class="n">start</span><span class="p">,</span><span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">dfatt</span><span class="o">.</span><span class="n">hneg</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="n">bartype</span><span class="p">,</span><span class="n">bottom</span><span class="o">=</span><span class="n">dfatt</span><span class="o">.</span><span class="n">start</span><span class="p">,</span><span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">allsort</span> <span class="k">else</span> <span class="n">dfatt</span><span class="o">.</span><span class="n">hbegin</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="n">bartype</span><span class="p">,</span><span class="n">bottom</span><span class="o">=</span><span class="n">dfatt</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
                <span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;green&#39;</span> <span class="k">if</span> <span class="n">dfatt</span><span class="o">.</span><span class="n">hbegin</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">zero</span> <span class="k">else</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">)</span>
        <span class="n">_</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">allsort</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">autosum</span> <span class="k">else</span> <span class="n">dfatt</span><span class="o">.</span><span class="n">hend</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="n">bartype</span><span class="p">,</span><span class="n">bottom</span><span class="o">=</span><span class="n">dfatt</span><span class="o">.</span><span class="n">start</span><span class="p">,</span><span class="n">stacked</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
        <span class="n">dec</span><span class="o">=</span><span class="n">finddec</span><span class="p">(</span><span class="n">dfatt</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">value</span><span class="p">,</span><span class="n">number</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">,.</span><span class="si">{</span><span class="n">dec</span><span class="si">}</span><span class="s1">f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">))</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">desdic</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">name</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">dfatt</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">70</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;x-large&#39;</span><span class="p">)</span>
<span class="c1">#        plt.xticks(rotation=45, horizontalalignment=&#39;right&#39;, </span>
<span class="c1">#                   fontweight=&#39;light&#39;, fontsize=&#39;x-large&#39;  )</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="k">if</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="p">)</span>

<span class="c1">#    plt.show()</span>
    <span class="k">return</span> <span class="n">fig</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span> <span class="ow">and</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="mi">100</span><span class="p">,</span><span class="mf">100.</span><span class="p">],[</span><span class="o">-</span><span class="mf">10.0</span><span class="p">,</span><span class="o">-</span><span class="mi">12</span><span class="p">],</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">],[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">]],</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nii&#39;</span><span class="p">,</span><span class="s1">&#39;cost&#39;</span><span class="p">,</span><span class="s1">&#39;credit&#39;</span><span class="p">,</span><span class="s1">&#39;fee&#39;</span><span class="p">],</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span><span class="s1">&#39;ex2&#39;</span><span class="p">])</span>
    <span class="n">basis</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">basis</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">waterplot</span><span class="p">(</span><span class="n">basis</span><span class="p">)</span>
    
 
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Ib Hansen.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>