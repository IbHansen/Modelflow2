<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>modeljupyter &mdash; ModelFlow  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
            <a href="../index.html" class="icon icon-home"> ModelFlow
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">content:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core/Core.html">Core Modules, creates and solves model instances</a></li>
<li class="toctree-l1"><a class="reference internal" href="../onboard/onboard.html">Processing model specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../attribution/Attribution.html">Attribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vis/modelvis.html">Quick result visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plotly/modeldashsidebar.html">Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jupyter/jupyter.html">Jupyter Stuff</a></li>
<li class="toctree-l1"><a class="reference internal" href="../used/modelinvert.html">Targets and instruments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../used/modelmf.html">Enrich dataframes with modelflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../used/model_cvx.html">Convex optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../used/modelsandbox.html">Template for a user defined  model class based on the model class</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Unsorted:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../unsorted/model_financial_stability.html">model_financial_stability module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unsorted/model_ifrs9.html">model_ifrs9 module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unsorted/model_run_numba.html">model_run_numba module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unsorted/modelclass2.html">modelclass2 module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unsorted/modeldash.html">modeldash module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unsorted/modeldashboot.html">modeldashboot module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unsorted/modeldiff.html">modeldiff module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unsorted/modelhelp.html">modelhelp module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unsorted/modelnet.html">modelnet module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unsorted/modelsandbox_Mixin.html">modelsandbox_Mixin module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unsorted/modeltodo.html">modeltodo module</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: white" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ModelFlow</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">modeljupyter</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for modeljupyter</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Sat Jun 22 21:26:13 2019</span>

<span class="sd">@author: hanseni</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span>  <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>  
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">clear_output</span><span class="p">,</span><span class="n">Latex</span><span class="p">,</span> <span class="n">Markdown</span>
<span class="kn">import</span> <span class="nn">matplotlib.pylab</span>  <span class="k">as</span> <span class="nn">plt</span> 
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">webbrowser</span> <span class="k">as</span> <span class="nn">wb</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">fnmatch</span> 
<span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="k">as</span> <span class="nn">ticker</span>



<span class="c1">#import qgrid </span>


 
<span class="kn">from</span>  <span class="nn">modelhelp</span> <span class="kn">import</span> <span class="n">insertModelVar</span><span class="p">,</span> <span class="n">finddec</span>
<span class="kn">import</span> <span class="nn">modelpattern</span> <span class="k">as</span> <span class="nn">pt</span>


<div class="viewcode-block" id="vis_alt3"><a class="viewcode-back" href="../jupyter/modeljupyter.html#modeljupyter.vis_alt3">[docs]</a><span class="k">def</span> <span class="nf">vis_alt3</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Show variables&#39;</span><span class="p">,</span><span class="n">basename</span><span class="o">=</span><span class="s1">&#39;Baseline&#39;</span><span class="p">,</span><span class="n">altname</span><span class="o">=</span><span class="s1">&#39;Alternative&#39;</span><span class="p">,</span><span class="n">trans</span><span class="o">=</span><span class="p">{},</span><span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; display tabbed widget with results from different dataframes, usuallly 2 but more can be shown</span>
<span class="sd">    </span>
<span class="sd">    dfs is a list of dataframes. They should be of same dimensionalities </span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">avar</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span>
    <span class="n">outlist</span> <span class="o">=</span>     <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">avar</span><span class="p">]</span>
    <span class="n">outdiflist</span> <span class="o">=</span>  <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">avar</span><span class="p">]</span>    
    <span class="n">deplist</span> <span class="o">=</span>     <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">avar</span><span class="p">]</span>
    <span class="n">reslist</span> <span class="o">=</span>     <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">avar</span><span class="p">]</span>
    <span class="n">attlist</span> <span class="o">=</span>     <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">avar</span><span class="p">]</span>
    <span class="n">varouttablist</span> <span class="o">=</span>  <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">Tab</span><span class="p">(</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">out</span><span class="p">,</span><span class="n">outdif</span><span class="p">,</span><span class="n">att</span><span class="p">,</span><span class="n">dep</span><span class="p">,</span><span class="n">res</span><span class="p">])</span> 
                      <span class="k">for</span> <span class="n">out</span><span class="p">,</span><span class="n">outdif</span><span class="p">,</span><span class="n">att</span><span class="p">,</span><span class="n">dep</span><span class="p">,</span><span class="n">res</span>  <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">outlist</span><span class="p">,</span><span class="n">outdiflist</span><span class="p">,</span><span class="n">attlist</span><span class="p">,</span><span class="n">deplist</span><span class="p">,</span><span class="n">reslist</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">var</span><span class="p">,</span><span class="n">varouttab</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">avar</span><span class="p">,</span><span class="n">varouttablist</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">tabtext</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;Level&#39;</span><span class="p">,</span><span class="s1">&#39;Impact&#39;</span><span class="p">,</span><span class="s1">&#39;Attribution&#39;</span><span class="p">,</span><span class="s1">&#39;Dependencies&#39;</span><span class="p">,</span><span class="s1">&#39;Results&#39;</span><span class="p">]):</span>
            <span class="n">varouttab</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">tabtext</span><span class="p">)</span>

    <span class="n">controllist</span> <span class="o">=</span> <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">varouttab</span><span class="p">])</span> <span class="k">for</span> <span class="n">varouttab</span> <span class="ow">in</span> <span class="n">varouttablist</span><span class="p">]</span>
    <span class="n">tab</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Tab</span><span class="p">(</span><span class="n">children</span> <span class="o">=</span> <span class="n">controllist</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">var</span><span class="p">,</span><span class="n">out</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">avar</span><span class="p">,</span><span class="n">controllist</span><span class="p">)):</span>
        <span class="n">tab</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span> 
    
    <span class="k">def</span> <span class="nf">showvar</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">outlist</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span>
        <span class="n">outdif</span> <span class="o">=</span> <span class="n">outdiflist</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span>
        <span class="n">dep</span> <span class="o">=</span> <span class="n">deplist</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">reslist</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span>
        <span class="n">att</span> <span class="o">=</span> <span class="n">attlist</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">avar</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">clear_output</span><span class="p">()</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">var</span><span class="p">),</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="c1">#            ax.spines[&#39;top&#39;].set_visible(False)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">df</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dfs</span><span class="p">):</span>
                <span class="n">alt</span><span class="o">=</span><span class="n">i</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dfs</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">var</span><span class="p">]</span>
                <span class="n">data</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">basename</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span><span class="mi">0</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">altname</span><span class="si">}{</span><span class="n">alt</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="n">legend</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
                <span class="n">x_pos</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">legend</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">basevalue</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">basevalue</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.01</span> <span class="ow">or</span> 
                          <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">basevalue</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">100.</span> <span class="ow">and</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">basevalue</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.008</span><span class="p">))):</span>
                            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_pos</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="p">,</span><span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">basename</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="n">altname</span><span class="si">}{</span><span class="n">alt</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_pos</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="p">,</span><span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">altname</span><span class="si">}{</span><span class="n">alt</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_pos</span><span class="p">,</span> <span class="n">basevalue</span>  <span class="p">,</span><span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">basename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">outdif</span><span class="p">:</span>
            <span class="n">clear_output</span><span class="p">()</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">var</span><span class="p">),</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">df</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dfs</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">basedata</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">var</span><span class="p">]</span>
                    <span class="n">x_pos</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">var</span><span class="p">]</span><span class="o">-</span><span class="n">basedata</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
                    <span class="n">x_pos</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">alt</span><span class="o">=</span><span class="n">i</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dfs</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_pos</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="p">,</span><span class="sa">f</span><span class="s1">&#39; Impact of </span><span class="si">{</span><span class="n">altname</span><span class="si">}{</span><span class="n">alt</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">dep</span><span class="p">:</span>
            <span class="n">clear_output</span><span class="p">()</span>
            <span class="n">model</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">up</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">down</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">svg</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">res</span><span class="p">:</span>
            <span class="n">clear_output</span><span class="p">()</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_values</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Base&#39;</span><span class="p">:</span><span class="n">basename</span><span class="p">,</span><span class="s1">&#39;Last&#39;</span><span class="p">:</span><span class="n">altname</span><span class="p">})</span>
            <span class="n">out</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">var</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">var</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">att</span><span class="p">:</span>
            <span class="n">clear_output</span><span class="p">()</span>
            <span class="c1">#model.smpl(N-20,N)</span>
            <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">endogene</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;What explains the difference between the </span><span class="si">{</span><span class="n">basename</span><span class="si">}</span><span class="s1"> and the </span><span class="si">{</span><span class="n">altname</span><span class="si">}</span><span class="s1"> run &#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">allvar</span><span class="p">[</span><span class="n">var</span><span class="p">][</span><span class="s1">&#39;frml&#39;</span><span class="p">])</span>
                <span class="n">model</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">up</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">dec</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span><span class="n">svg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">HR</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1"> is exogeneous and attribution can not be performed&#39;</span><span class="p">)</span>
            
    <span class="n">display</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span> 

    <span class="n">showvar</span><span class="p">({</span><span class="s1">&#39;new&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">})</span>
    <span class="n">tab</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">showvar</span><span class="p">,</span><span class="s1">&#39;selected_index&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tab</span></div>

<div class="viewcode-block" id="vis_alt4"><a class="viewcode-back" href="../jupyter/modeljupyter.html#modeljupyter.vis_alt4">[docs]</a><span class="k">def</span> <span class="nf">vis_alt4</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span><span class="n">model</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Show variables&#39;</span><span class="p">,</span><span class="n">trans</span><span class="o">=</span><span class="p">{},</span><span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; display tabbed widget with results from different dataframes, usuallly 2 but more can be shown</span>
<span class="sd">    </span>
<span class="sd">    dfs is a list of dataframes. They should be of same dimensionalities </span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">avar</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">dfs</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">columns</span>
    <span class="n">outlist</span> <span class="o">=</span>     <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">avar</span><span class="p">]</span>
    <span class="n">outdiflist</span> <span class="o">=</span>  <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">avar</span><span class="p">]</span>    
    <span class="n">deplist</span> <span class="o">=</span>     <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">avar</span><span class="p">]</span>
    <span class="n">reslist</span> <span class="o">=</span>     <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">avar</span><span class="p">]</span>
    <span class="n">attlist</span> <span class="o">=</span>     <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">avar</span><span class="p">]</span>
    <span class="n">varouttablist</span> <span class="o">=</span>  <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">Tab</span><span class="p">(</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">out</span><span class="p">,</span><span class="n">outdif</span><span class="p">,</span><span class="n">att</span><span class="p">,</span><span class="n">dep</span><span class="p">,</span><span class="n">res</span><span class="p">])</span> 
                      <span class="k">for</span> <span class="n">out</span><span class="p">,</span><span class="n">outdif</span><span class="p">,</span><span class="n">att</span><span class="p">,</span><span class="n">dep</span><span class="p">,</span><span class="n">res</span>  <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">outlist</span><span class="p">,</span><span class="n">outdiflist</span><span class="p">,</span><span class="n">attlist</span><span class="p">,</span><span class="n">deplist</span><span class="p">,</span><span class="n">reslist</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">var</span><span class="p">,</span><span class="n">varouttab</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">avar</span><span class="p">,</span><span class="n">varouttablist</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">tabtext</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;Level&#39;</span><span class="p">,</span><span class="s1">&#39;Impact&#39;</span><span class="p">,</span><span class="s1">&#39;Attribution&#39;</span><span class="p">,</span><span class="s1">&#39;Dependencies&#39;</span><span class="p">,</span><span class="s1">&#39;Results&#39;</span><span class="p">]):</span>
            <span class="n">varouttab</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">tabtext</span><span class="p">)</span>

    <span class="n">controllist</span> <span class="o">=</span> <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">varouttab</span><span class="p">])</span> <span class="k">for</span> <span class="n">varouttab</span> <span class="ow">in</span> <span class="n">varouttablist</span><span class="p">]</span>
    <span class="n">tab</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Tab</span><span class="p">(</span><span class="n">children</span> <span class="o">=</span> <span class="n">controllist</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">var</span><span class="p">,</span><span class="n">out</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">avar</span><span class="p">,</span><span class="n">controllist</span><span class="p">)):</span>
        <span class="n">tab</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span> 
    
    <span class="k">def</span> <span class="nf">showvar</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
        <span class="n">sel</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">outlist</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span>
        <span class="n">outdif</span> <span class="o">=</span> <span class="n">outdiflist</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span>
        <span class="n">dep</span> <span class="o">=</span> <span class="n">deplist</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">reslist</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span>
        <span class="n">att</span> <span class="o">=</span> <span class="n">attlist</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">avar</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">clear_output</span><span class="p">()</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">var</span><span class="p">),</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="c1">#            ax.spines[&#39;top&#39;].set_visible(False)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">k</span><span class="p">,</span><span class="n">df</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dfs</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">var</span><span class="p">]</span>
                <span class="n">data</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">k</span>
                <span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="n">legend</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
                <span class="n">x_pos</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">legend</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">basevalue</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">basevalue</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.01</span> <span class="ow">or</span> 
                          <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">basevalue</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">100.</span> <span class="ow">and</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">basevalue</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.008</span><span class="p">))):</span>
                            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_pos</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="p">,</span><span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">basename</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="n">altname</span><span class="si">}{</span><span class="n">alt</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_pos</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="p">,</span><span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">altname</span><span class="si">}{</span><span class="n">alt</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_pos</span><span class="p">,</span> <span class="n">basevalue</span>  <span class="p">,</span><span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">basename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">outdif</span><span class="p">:</span>
            <span class="n">clear_output</span><span class="p">()</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">var</span><span class="p">),</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">k</span><span class="p">,</span><span class="n">df</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dfs</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">basedata</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">var</span><span class="p">]</span>
                    <span class="n">x_pos</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">var</span><span class="p">]</span><span class="o">-</span><span class="n">basedata</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39; Impact of: </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="n">legend</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
                    <span class="n">x_pos</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">legend</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_pos</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="p">,</span><span class="sa">f</span><span class="s1">&#39; Impact of: </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">dep</span><span class="p">:</span>
            <span class="n">clear_output</span><span class="p">()</span>
            <span class="n">model</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">up</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">down</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">svg</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">res</span><span class="p">:</span>
            <span class="n">clear_output</span><span class="p">()</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">var</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">df</span> <span class="ow">in</span> <span class="n">dfs</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">out</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dfs</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
            <span class="n">out</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">var</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">trans</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">var</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">to_string</span><span class="p">())</span>
        <span class="k">with</span> <span class="n">att</span><span class="p">:</span>
            <span class="n">clear_output</span><span class="p">()</span>
            <span class="c1">#model.smpl(N-20,N)</span>
            <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">endogene</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;What explains the difference between the </span><span class="si">{</span><span class="n">basename</span><span class="si">}</span><span class="s1"> and the </span><span class="si">{</span><span class="n">altname</span><span class="si">}</span><span class="s1"> run &#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">allvar</span><span class="p">[</span><span class="n">var</span><span class="p">][</span><span class="s1">&#39;frml&#39;</span><span class="p">])</span>
                <span class="n">model</span><span class="o">.</span><span class="n">explain</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">up</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">dec</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span><span class="n">svg</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">HR</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1"> is exogeneous and attribution can not be performed&#39;</span><span class="p">)</span>
            
    <span class="n">display</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span> 

    <span class="n">showvar</span><span class="p">({</span><span class="s1">&#39;new&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">})</span>
    <span class="n">tab</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">showvar</span><span class="p">,</span><span class="s1">&#39;selected_index&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="jup_keepviz"><a class="viewcode-back" href="../jupyter/modeljupyter.html#modeljupyter.jup_keepviz">[docs]</a><span class="k">class</span> <span class="nc">jup_keepviz</span><span class="p">()</span> <span class="p">:</span>
    <span class="sd">&#39;&#39;&#39; Class to vizualize a number of runs, primary in Jupyter </span>
<span class="sd">    :dfs: A dict with runs {name :{&#39;result&#39; : df}}</span>
<span class="sd">    :title: A title </span>
<span class="sd">    :trans: a translation of variable names to more redable names</span>
<span class="sd">    :legend: if legends has to be shown </span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>



    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dfs</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Show variables&#39;</span><span class="p">,</span><span class="n">trans</span><span class="o">=</span><span class="p">{},</span><span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">showfig</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dfs</span> <span class="o">=</span> <span class="n">dfs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trans</span> <span class="o">=</span> <span class="n">trans</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">legend</span> <span class="o">=</span> <span class="n">legend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showfig</span> <span class="o">=</span> <span class="n">showfig</span>
        
        <span class="k">return</span> 
        
<div class="viewcode-block" id="jup_keepviz.plot_level"><a class="viewcode-back" href="../jupyter/modeljupyter.html#modeljupyter.jup_keepviz.plot_level">[docs]</a>    <span class="k">def</span> <span class="nf">plot_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">var</span><span class="p">):</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Level: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">var</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="k">if</span>  <span class="bp">self</span><span class="o">.</span><span class="n">legend</span> <span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            
<span class="c1">#            ax.spines[&#39;top&#39;].set_visible(False)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">k</span><span class="p">,</span><span class="n">df</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dfs</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">var</span><span class="p">]</span>
            <span class="n">data</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">k</span>
            <span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">legend</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="n">dec</span><span class="o">=</span><span class="n">finddec</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">value</span><span class="p">,</span><span class="n">number</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">,.</span><span class="si">{</span><span class="n">dec</span><span class="si">}</span><span class="s1">f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">))</span>

            <span class="n">x_pos</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">legend</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">basename</span> <span class="o">=</span> <span class="n">k</span>
                    <span class="n">basevalue</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_pos</span><span class="p">,</span> <span class="n">basevalue</span>  <span class="p">,</span><span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">basename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">basevalue</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.01</span> <span class="ow">or</span> 
                      <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">basevalue</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">100.</span> <span class="ow">and</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">basevalue</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.008</span><span class="p">))):</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_pos</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="p">,</span><span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">basename</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span> 
                            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_pos</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="p">,</span><span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
                            
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_pos</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="p">,</span><span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="jup_keepviz.plot_dif"><a class="viewcode-back" href="../jupyter/modeljupyter.html#modeljupyter.jup_keepviz.plot_dif">[docs]</a>    <span class="k">def</span> <span class="nf">plot_dif</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">var</span><span class="p">):</span>
         <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
         <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">var</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
         <span class="k">if</span>  <span class="bp">self</span><span class="o">.</span><span class="n">legend</span> <span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
         <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">k</span><span class="p">,</span><span class="n">df</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dfs</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
             <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                 <span class="n">basedata</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">var</span><span class="p">]</span>
             <span class="k">else</span><span class="p">:</span>
                 <span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">var</span><span class="p">]</span><span class="o">-</span><span class="n">basedata</span>
                 <span class="n">data</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39; Impact of: </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">&#39;</span>
                 <span class="n">dec</span><span class="o">=</span><span class="n">finddec</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

                 <span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">legend</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
                 <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">value</span><span class="p">,</span><span class="n">number</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s1">,.</span><span class="si">{</span><span class="n">dec</span><span class="si">}</span><span class="s1">f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">))</span>
                 
                 <span class="n">x_pos</span> <span class="o">=</span> <span class="n">basedata</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                 <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">legend</span><span class="p">:</span>
                     <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_pos</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="p">,</span><span class="sa">f</span><span class="s1">&#39; Impact of: </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
         <span class="k">return</span> <span class="n">fig</span> </div>

<div class="viewcode-block" id="jup_keepviz.formatnumber"><a class="viewcode-back" href="../jupyter/modeljupyter.html#modeljupyter.jup_keepviz.formatnumber">[docs]</a>    <span class="k">def</span> <span class="nf">formatnumber</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">var</span><span class="p">,</span><span class="n">out</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">out</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mf">30.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">lambda</span> <span class="n">number</span> <span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">number</span><span class="si">:</span><span class="s1">,.0f</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">lambda</span> <span class="n">number</span> <span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">number</span><span class="si">:</span><span class="s1">,.6f</span><span class="si">}</span><span class="s1">&#39;</span></div></div>
 
    
<div class="viewcode-block" id="jupviz"><a class="viewcode-back" href="../jupyter/modeljupyter.html#modeljupyter.jupviz">[docs]</a><span class="k">class</span> <span class="nc">jupviz</span><span class="p">(</span><span class="n">jup_keepviz</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class to vizualize a number of experiments in an tabbed ipywidget in a jupyter notebook</span>
<span class="sd">    &#39;&#39;&#39;</span> 
             
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vis</span><span class="p">()</span>
   
<div class="viewcode-block" id="jupviz.vis"><a class="viewcode-back" href="../jupyter/modeljupyter.html#modeljupyter.jupviz.vis">[docs]</a>    <span class="k">def</span> <span class="nf">vis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; display tabbed widget with results from different dataframes, usuallly 2 but more can be shown</span>
<span class="sd">        </span>
<span class="sd">        dfs is a list of dataframes. They should be of same dimensionalities </span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basekey</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span>  <span class="bp">self</span><span class="o">.</span><span class="n">dfs</span><span class="o">.</span><span class="n">keys</span><span class="p">()][</span><span class="mi">0</span><span class="p">]</span> 

        <span class="n">wexperiment_name</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">basekey</span><span class="p">,</span><span class="n">placeholder</span><span class="o">=</span><span class="s1">&#39;Type something&#39;</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Name of these experiments:&#39;</span><span class="p">,</span>
                            <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span><span class="s1">&#39;55%&#39;</span><span class="p">},</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span><span class="s1">&#39;45%&#39;</span><span class="p">})</span>
        
        <span class="n">wsavefig</span>   <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Save figure&quot;</span><span class="p">)</span>
        <span class="n">wbut</span>  <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="n">wsavefig</span><span class="p">,</span><span class="n">wexperiment_name</span><span class="p">])</span>
        
        <span class="n">wfile_folder</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;test2&#39;</span><span class="p">,</span><span class="n">placeholder</span><span class="o">=</span><span class="s1">&#39;Type something&#39;</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Figure saved in:&#39;</span><span class="p">,</span>
                            <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span><span class="s1">&#39;65%&#39;</span><span class="p">},</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span><span class="s1">&#39;25%&#39;</span><span class="p">},</span><span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">disabled</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">wfile_folder</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        
        <span class="n">wopen</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Open the saved figures&quot;</span><span class="p">)</span>
        <span class="n">wopen</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        
        <span class="n">winputstring</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">wfile_folder</span><span class="p">,</span><span class="n">wopen</span><span class="p">])</span>
          
        
        <span class="n">avar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dfs</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dfs</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">columns</span>
        <span class="n">outlist</span> <span class="o">=</span>     <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">avar</span><span class="p">]</span>
        <span class="n">outdiflist</span> <span class="o">=</span>  <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">avar</span><span class="p">]</span>    
        <span class="n">reslist</span> <span class="o">=</span>     <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">avar</span><span class="p">]</span>
        <span class="n">resdiflist</span> <span class="o">=</span>  <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">Output</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">avar</span><span class="p">]</span>
        <span class="n">varouttablist</span> <span class="o">=</span>  <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">Tab</span><span class="p">(</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">out</span><span class="p">,</span><span class="n">outdif</span><span class="p">,</span><span class="n">res</span><span class="p">,</span><span class="n">resdif</span><span class="p">])</span> 
                          <span class="k">for</span> <span class="n">out</span><span class="p">,</span><span class="n">outdif</span><span class="p">,</span><span class="n">res</span><span class="p">,</span><span class="n">resdif</span>  <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">outlist</span><span class="p">,</span><span class="n">outdiflist</span><span class="p">,</span><span class="n">reslist</span><span class="p">,</span><span class="n">resdiflist</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">var</span><span class="p">,</span><span class="n">varouttab</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">avar</span><span class="p">,</span><span class="n">varouttablist</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">tabtext</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;Level&#39;</span><span class="p">,</span><span class="s1">&#39;Impact&#39;</span><span class="p">,</span><span class="s1">&#39;Level data&#39;</span><span class="p">,</span><span class="s1">&#39;Impact data&#39;</span><span class="p">]):</span>
                <span class="n">varouttab</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">tabtext</span><span class="p">)</span>
    
        <span class="n">controllist</span> <span class="o">=</span> <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">varouttab</span><span class="p">])</span> <span class="k">for</span> <span class="n">varouttab</span> <span class="ow">in</span> <span class="n">varouttablist</span><span class="p">]</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Tab</span><span class="p">(</span><span class="n">children</span> <span class="o">=</span> <span class="n">controllist</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">var</span><span class="p">,</span><span class="n">out</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">avar</span><span class="p">,</span><span class="n">controllist</span><span class="p">)):</span>
            <span class="n">tab</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span> 
        
        <span class="k">def</span> <span class="nf">showvar</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="n">wfile_folder</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
            <span class="n">wopen</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>

            <span class="n">sel</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">]</span>
            <span class="n">out</span>    <span class="o">=</span> <span class="n">outlist</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span>
            <span class="n">outdif</span> <span class="o">=</span> <span class="n">outdiflist</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span>
            <span class="n">res</span>    <span class="o">=</span> <span class="n">reslist</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span>
            <span class="n">resdif</span> <span class="o">=</span> <span class="n">resdiflist</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span>
            <span class="n">var</span>    <span class="o">=</span> <span class="n">avar</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selected</span> <span class="o">=</span> <span class="n">sel</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selected_var</span> <span class="o">=</span> <span class="n">var</span> 
            <span class="k">with</span> <span class="n">out</span><span class="p">:</span>
                <span class="n">clear_output</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fig_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_level</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_level</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">outdif</span><span class="p">:</span>
                <span class="n">clear_output</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fig_dif</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_dif</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig_dif</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">res</span><span class="p">:</span>
                <span class="n">clear_output</span><span class="p">()</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">var</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">df</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dfs</span><span class="o">.</span><span class="n">items</span><span class="p">()],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">out</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dfs</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">var</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">float_format</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatnumber</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">out</span><span class="p">)))</span>
            <span class="k">with</span> <span class="n">resdif</span><span class="p">:</span>
                <span class="n">clear_output</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">baseline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dfs</span><span class="p">[[</span><span class="n">k</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dfs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="n">var</span><span class="p">]]</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="n">var</span><span class="p">]]</span><span class="o">-</span><span class="n">baseline</span> <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">k</span><span class="p">,</span><span class="n">df</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dfs</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">out</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dfs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="c1"># out.style.set_caption(self.trans.get(var,var))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trans</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">var</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">float_format</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatnumber</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">out</span><span class="p">)))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No Data&#39;</span><span class="p">)</span>
     
        <span class="n">outtab</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">([</span><span class="n">tab</span><span class="p">,</span><span class="n">wbut</span><span class="p">,</span><span class="n">winputstring</span><span class="p">])</span>
        <span class="k">def</span> <span class="nf">savefig</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">graph_folde</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="s1">&#39;experiments&#39;</span><span class="p">,</span><span class="n">wexperiment_name</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="s1">&#39;graph&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">figlocation</span>        <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_folde</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">figlocation_impact</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_folde</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_var</span><span class="si">}</span><span class="s1">-impact&#39;</span><span class="p">)</span> 
            <span class="n">wfile_folder</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">showfig</span><span class="p">:</span>
                <span class="n">wopen</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">wopen</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_folde</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_folde</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span> 
                <span class="n">wfile_folder</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Can&#39;t create  </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_folde</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">return</span> 

            <span class="k">try</span><span class="p">:</span>       
                <span class="bp">self</span><span class="o">.</span><span class="n">fig_level</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figlocation</span><span class="o">+</span><span class="s1">&#39;.svg&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fig_dif</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figlocation_impact</span><span class="o">+</span><span class="s1">&#39;.svg&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fig_level</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figlocation</span><span class="o">+</span><span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fig_dif</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figlocation_impact</span><span class="o">+</span><span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>
                <span class="n">wfile_folder</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph_folde</span>
            <span class="k">except</span><span class="p">:</span> 
                <span class="n">wfile_folder</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Can&#39;t write to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_folde</span><span class="si">}</span><span class="s2">, remember to close&quot;</span>

        <span class="k">def</span> <span class="nf">openfig_svg</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">wb</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figlocation_impact</span><span class="o">+</span><span class="s1">&#39;.svg&#39;</span><span class="p">,</span><span class="n">new</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">wb</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figlocation</span><span class="o">+</span><span class="s1">&#39;.svg&#39;</span><span class="p">,</span><span class="n">new</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="c1"># os.system(self.figlocation)</span>
                <span class="c1"># os.system(self.figlocation_impact)</span>
            <span class="k">except</span><span class="p">:</span> 
                <span class="n">wfile_folder</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
                <span class="n">wfile_folder</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Can&#39;t open to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">figlocation</span><span class="si">}</span><span class="s2">.svg Try to download the file&quot;</span>
                
        <span class="k">def</span> <span class="nf">openfig_pdf</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">wb</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figlocation_impact</span><span class="o">+</span><span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>
                <span class="n">wb</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figlocation</span><span class="o">+</span><span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span> 
                <span class="n">wfile_folder</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
                <span class="n">wfile_folder</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Can&#39;t open to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">figlocation</span><span class="si">}</span><span class="s2">.svg Try to download the file&quot;</span>
                


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">showfig</span> <span class="p">:</span> <span class="n">wopen</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">openfig_svg</span><span class="p">)</span>
            
        <span class="n">wsavefig</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">savefig</span><span class="p">)</span>
      
        <span class="n">display</span><span class="p">(</span><span class="n">outtab</span><span class="p">)</span> 
    
        <span class="n">showvar</span><span class="p">({</span><span class="s1">&#39;new&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">})</span>
        <span class="n">tab</span><span class="o">.</span><span class="n">observe</span><span class="p">(</span><span class="n">showvar</span><span class="p">,</span><span class="s1">&#39;selected_index&#39;</span><span class="p">)</span></div></div>
        
            
     
<span class="c1"># Define data extraction</span>
        
        
<div class="viewcode-block" id="get_alt"><a class="viewcode-back" href="../jupyter/modeljupyter.html#modeljupyter.get_alt">[docs]</a><span class="k">def</span> <span class="nf">get_alt</span><span class="p">(</span><span class="n">mmodel</span><span class="p">,</span><span class="n">pat</span><span class="p">,</span><span class="n">onlyendo</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Retrieves variables matching pat from a model &#39;&#39;&#39;</span>
    <span class="n">varnames</span> <span class="o">=</span> <span class="n">mmodel</span><span class="o">.</span><span class="n">vlist</span><span class="p">(</span><span class="n">pat</span><span class="p">)</span>
    <span class="n">modelvar</span> <span class="o">=</span> <span class="n">mmodel</span><span class="o">.</span><span class="n">endogene</span> <span class="k">if</span> <span class="n">onlyendo</span> <span class="k">else</span> <span class="n">mmodel</span><span class="o">.</span><span class="n">exogene</span> <span class="o">|</span> <span class="n">mmodel</span><span class="o">.</span><span class="n">endogene</span> 
    <span class="n">modelvarnames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">varnames</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">modelvar</span><span class="p">]))</span> <span class="c1"># to awoid dublicate names</span>
    <span class="n">per</span> <span class="o">=</span> <span class="n">mmodel</span><span class="o">.</span><span class="n">current_per</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">mmodel</span><span class="o">.</span><span class="n">basedf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">per</span><span class="p">,</span><span class="n">modelvarnames</span><span class="p">],</span><span class="n">mmodel</span><span class="o">.</span><span class="n">lastdf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">per</span><span class="p">,</span><span class="n">modelvarnames</span><span class="p">]]</span></div>

<div class="viewcode-block" id="get_alt_dic"><a class="viewcode-back" href="../jupyter/modeljupyter.html#modeljupyter.get_alt_dic">[docs]</a><span class="k">def</span> <span class="nf">get_alt_dic</span><span class="p">(</span><span class="n">mmodel</span><span class="p">,</span><span class="n">pat</span><span class="p">,</span><span class="n">dfs</span><span class="p">,</span><span class="n">onlyendo</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Retrieves variables matching pat from a model &#39;&#39;&#39;</span>
    <span class="n">varnames</span> <span class="o">=</span> <span class="n">mmodel</span><span class="o">.</span><span class="n">vlist</span><span class="p">(</span><span class="n">pat</span><span class="p">)</span>
    <span class="n">modelvar</span> <span class="o">=</span> <span class="n">mmodel</span><span class="o">.</span><span class="n">endogene</span> <span class="k">if</span> <span class="n">onlyendo</span> <span class="k">else</span> <span class="n">mmodel</span><span class="o">.</span><span class="n">exogene</span> <span class="o">|</span> <span class="n">mmodel</span><span class="o">.</span><span class="n">endogene</span> 
    <span class="n">modelvarnames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">varnames</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">modelvar</span><span class="p">]))</span> <span class="c1"># to awoid dublicate names</span>
    <span class="n">per</span> <span class="o">=</span> <span class="n">mmodel</span><span class="o">.</span><span class="n">current_per</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">df_dic</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">per</span><span class="p">,</span><span class="n">modelvarnames</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">df_dic</span> <span class="ow">in</span> <span class="n">dfs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span></div>






<div class="viewcode-block" id="inputwidget"><a class="viewcode-back" href="../jupyter/modeljupyter.html#modeljupyter.inputwidget">[docs]</a><span class="k">def</span> <span class="nf">inputwidget</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">basedf</span><span class="p">,</span><span class="n">slidedef</span><span class="o">=</span><span class="p">{},</span><span class="n">radiodef</span><span class="o">=</span><span class="p">[],</span><span class="n">checkdef</span><span class="o">=</span><span class="p">[],</span><span class="n">modelopt</span><span class="o">=</span><span class="p">{},</span><span class="n">varpat</span><span class="o">=</span><span class="s1">&#39;RFF XGDPN RFFMIN GFSRPN DMPTRSH XXIBDUMMY&#39;</span>
                 <span class="p">,</span><span class="n">showout</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">trans</span><span class="o">=</span><span class="p">{},</span><span class="n">base1name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">alt1name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">go_now</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">showvar</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Creates an input widgets for updating variables </span>
<span class="sd">    </span>
<span class="sd">    :df: Baseline dataframe </span>
<span class="sd">    :slidedef: dict with definition of variables to be updated by slider</span>
<span class="sd">    :radiodef: dict of lists. each at first level defines a collection of radiobuttoms</span>
<span class="sd">               second level defines the text for each leved and the variable to set or reset to 0</span>
<span class="sd">    :varpat: the variables to show in the output widget</span>
<span class="sd">    :showout: 1 if the output widget is to be called &#39;&#39;&#39;</span>
    
    <span class="n">lradiodef</span><span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">radiodef</span><span class="p">)</span>
    <span class="n">lslidedef</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">slidedef</span><span class="p">)</span>
    <span class="n">lcheckdef</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">checkdef</span><span class="p">)</span>
    <span class="n">basename</span> <span class="o">=</span> <span class="n">base1name</span> <span class="k">if</span> <span class="n">base1name</span> <span class="k">else</span> <span class="s1">&#39;Baseline&#39;</span> 
    <span class="n">altname</span> <span class="o">=</span> <span class="n">alt1name</span> <span class="k">if</span> <span class="n">alt1name</span> <span class="k">else</span> <span class="s1">&#39;Alternative&#39;</span> 
    
    <span class="k">if</span> <span class="n">lradiodef</span><span class="p">:</span> 
        <span class="n">wradiolist</span> <span class="o">=</span> <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">RadioButtons</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="n">cont</span><span class="p">],</span><span class="n">description</span><span class="o">=</span><span class="n">des</span><span class="p">,</span><span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span><span class="s1">&#39;70%&#39;</span><span class="p">},</span>
                                           <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span><span class="s1">&#39;37%&#39;</span><span class="p">})</span> <span class="k">for</span> <span class="n">des</span><span class="p">,</span><span class="n">cont</span> <span class="ow">in</span> <span class="n">radiodef</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wradiolist</span><span class="p">)</span> <span class="o">&lt;=</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">wradio</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">(</span><span class="n">wradiolist</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">wradio</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">(</span><span class="n">wradiolist</span><span class="p">)</span>

            

<span class="c1"># define slidesets </span>
    <span class="k">if</span> <span class="n">lslidedef</span><span class="p">:</span>     
        <span class="n">wexp</span>  <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;Input new parameter &quot;</span><span class="p">,</span><span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span><span class="s1">&#39;52%&#39;</span><span class="p">})</span>
        <span class="n">walt</span>  <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">altname</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span><span class="s1">&#39;10%&#39;</span><span class="p">})</span>
        <span class="n">wbas</span>  <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">basename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span><span class="s1">&#39;20%&#39;</span><span class="p">})</span>
        <span class="n">whead</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="n">wexp</span><span class="p">,</span><span class="n">walt</span><span class="p">,</span><span class="n">wbas</span><span class="p">])</span>
        
        <span class="n">wset</span>  <span class="o">=</span> <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="n">des</span><span class="p">,</span>
                                    <span class="nb">min</span><span class="o">=</span><span class="n">cont</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">],</span><span class="nb">max</span><span class="o">=</span><span class="n">cont</span><span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">],</span><span class="n">value</span><span class="o">=</span><span class="n">cont</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span><span class="n">step</span><span class="o">=</span><span class="n">cont</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="mf">0.01</span><span class="p">),</span>
                                    <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span><span class="s1">&#39;60%&#39;</span><span class="p">},</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span><span class="s1">&#39;40%&#39;</span><span class="p">},</span><span class="n">readout_format</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;:&lt;,.</span><span class="si">{</span><span class="n">cont</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dec&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">f&quot;</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">des</span><span class="p">,</span><span class="n">cont</span> <span class="ow">in</span> <span class="n">slidedef</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="n">formattest</span> <span class="o">=</span> <span class="s1">&#39;:&gt;.2f&#39;</span>
        <span class="n">waltval</span><span class="o">=</span> <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cont</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;,.</span><span class="si">{</span><span class="n">cont</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dec&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span><span class="s1">&#39;10%&#39;</span><span class="p">})</span>
                  <span class="k">for</span> <span class="n">des</span><span class="p">,</span><span class="n">cont</span>  <span class="ow">in</span> <span class="n">slidedef</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="n">wslide</span> <span class="o">=</span> <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="n">s</span><span class="p">,</span><span class="n">v</span><span class="p">])</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">wset</span><span class="p">,</span><span class="n">waltval</span><span class="p">)]</span>
       
<span class="c1"># cheklist  </span>
    <span class="k">if</span> <span class="n">lcheckdef</span><span class="p">:</span>         
        <span class="n">wchecklist</span> <span class="o">=</span> <span class="p">[</span><span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="n">des</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="n">val</span><span class="p">)</span>   <span class="k">for</span> <span class="n">des</span><span class="p">,</span><span class="n">var</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">checkdef</span><span class="p">]</span>
        <span class="n">wcheck</span>  <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">(</span><span class="n">wchecklist</span><span class="p">)</span>   

<span class="c1"># some buttons and text     </span>
    <span class="n">wname</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">basename</span><span class="p">,</span><span class="n">placeholder</span><span class="o">=</span><span class="s1">&#39;Type something&#39;</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Scenario name:&#39;</span><span class="p">,</span>
                        <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span><span class="s1">&#39;30%&#39;</span><span class="p">},</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span><span class="s1">&#39;50%&#39;</span><span class="p">})</span>
    <span class="n">wpat</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">varpat</span><span class="p">,</span><span class="n">placeholder</span><span class="o">=</span><span class="s1">&#39;Type something&#39;</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Output variables:&#39;</span><span class="p">,</span>
                        <span class="n">layout</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;width&#39;</span><span class="p">:</span><span class="s1">&#39;65%&#39;</span><span class="p">},</span><span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span><span class="s1">&#39;30%&#39;</span><span class="p">})</span>
    <span class="k">if</span> <span class="n">showvar</span><span class="p">:</span>
        <span class="n">wpat</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;visible&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">wpat</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">visibility</span> <span class="o">=</span> <span class="s1">&#39;hidden&#39;</span>
        

    <span class="n">winputstring</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="n">wname</span><span class="p">,</span><span class="n">wpat</span><span class="p">])</span>
    
    <span class="n">wgo</span>   <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Run scenario&quot;</span><span class="p">)</span>
    <span class="n">wreset</span>   <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Reset to start&quot;</span><span class="p">)</span>
    <span class="n">wzero</span>   <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Set all to 0&quot;</span><span class="p">)</span>
    <span class="n">wsetbas</span>   <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Use as baseline&quot;</span><span class="p">)</span>
    <span class="n">wbut</span>  <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">HBox</span><span class="p">([</span><span class="n">wgo</span><span class="p">,</span><span class="n">wreset</span><span class="p">,</span><span class="n">wzero</span><span class="p">,</span><span class="n">wsetbas</span><span class="p">])</span>
    
    <span class="n">wvar</span> <span class="o">=</span> <span class="p">[</span><span class="n">whead</span><span class="p">]</span><span class="o">+</span><span class="n">wslide</span> <span class="k">if</span> <span class="n">lslidedef</span> <span class="k">else</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">lradiodef</span><span class="p">:</span> <span class="n">wvar</span> <span class="o">=</span> <span class="n">wvar</span> <span class="o">+</span> <span class="p">[</span><span class="n">wradio</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">lcheckdef</span><span class="p">:</span> <span class="n">wvar</span> <span class="o">=</span> <span class="n">wvar</span> <span class="o">+</span> <span class="p">[</span><span class="n">wcheck</span><span class="p">]</span>
        
    <span class="n">w</span>     <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">VBox</span><span class="p">(</span><span class="n">wvar</span><span class="o">+</span><span class="p">[</span><span class="n">winputstring</span><span class="p">]</span> <span class="o">+</span><span class="p">[</span><span class="n">wbut</span><span class="p">])</span>

    <span class="c1"># This function is run when the button is clecked </span>
    <span class="n">firstrun</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">model</span><span class="o">.</span><span class="n">rundic</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
        <span class="k">nonlocal</span> <span class="n">firstrun</span>
        <span class="k">nonlocal</span> <span class="n">altname</span>
        <span class="c1"># mulstart       = model.basedf.copy()</span>
        <span class="n">mulstart</span>       <span class="o">=</span> <span class="n">insertModelVar</span><span class="p">(</span><span class="n">basedf</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span><span class="n">model</span><span class="p">)</span>
        <span class="c1"># model.smpl(df=mulstart)</span>
        
        <span class="c1"># First update from the sliders </span>
        <span class="k">if</span> <span class="n">lslidedef</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">des</span><span class="p">,</span><span class="n">cont</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">slidedef</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">op</span> <span class="o">=</span> <span class="n">cont</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;op&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>
                <span class="n">var</span> <span class="o">=</span> <span class="n">cont</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">cont</span><span class="p">[</span><span class="s1">&#39;var&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
                    <span class="k">if</span>  <span class="n">op</span> <span class="o">==</span> <span class="s1">&#39;+&#39;</span><span class="p">:</span>
                        <span class="n">mulstart</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">current_per</span><span class="p">,</span><span class="n">var</span><span class="p">]</span>    <span class="o">=</span>  <span class="n">mulstart</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">current_per</span><span class="p">,</span><span class="n">var</span><span class="p">]</span> <span class="o">+</span> <span class="n">wset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                    <span class="k">elif</span>  <span class="n">op</span> <span class="o">==</span> <span class="s1">&#39;%&#39;</span><span class="p">:</span>
                        <span class="n">mulstart</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">current_per</span><span class="p">,</span><span class="n">var</span><span class="p">]</span>    <span class="o">=</span>  <span class="n">mulstart</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">current_per</span><span class="p">,</span><span class="n">var</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">wset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="s1">&#39;+impulse&#39;</span><span class="p">:</span>    
                        <span class="n">mulstart</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">current_per</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span>  <span class="n">mulstart</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">current_per</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">var</span><span class="p">]</span> <span class="o">+</span> <span class="n">wset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                    <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="s1">&#39;=start-&#39;</span><span class="p">:</span>   
                        <span class="n">startindex</span> <span class="o">=</span> <span class="n">mulstart</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">current_per</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">varloc</span> <span class="o">=</span> <span class="n">mulstart</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
                        <span class="n">mulstart</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">startindex</span><span class="p">,</span><span class="n">varloc</span><span class="p">]</span> <span class="o">=</span>  <span class="n">wset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                    <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="s1">&#39;=&#39;</span><span class="p">:</span>    
                        <span class="n">mulstart</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">current_per</span><span class="p">,</span><span class="n">var</span><span class="p">]</span>    <span class="o">=</span>   <span class="n">wset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                    <span class="k">elif</span> <span class="n">op</span> <span class="o">==</span> <span class="s1">&#39;=impulse&#39;</span><span class="p">:</span>    
                        <span class="n">mulstart</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">current_per</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span>   <span class="n">wset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Wrong operator in </span><span class="si">{</span><span class="n">cont</span><span class="si">}</span><span class="s1">.</span><span class="se">\n</span><span class="s1">Not updated&#39;</span><span class="p">)</span>
                        <span class="k">assert</span> <span class="mi">1</span><span class="o">==</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;wRONG OPERATOR&#39;</span>
                
        <span class="c1"># now  update from the radio buttons </span>
        <span class="k">if</span> <span class="n">lradiodef</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">wradio</span><span class="p">,(</span><span class="n">des</span><span class="p">,</span><span class="n">cont</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">wradiolist</span><span class="p">,</span><span class="n">radiodef</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="c1"># print(des,wradio.value,wradio.index,cont[wradio.index])</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">cont</span><span class="p">:</span>
                    <span class="n">mulstart</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">current_per</span><span class="p">,</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">mulstart</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">current_per</span><span class="p">,</span><span class="n">cont</span><span class="p">[</span><span class="n">wradio</span><span class="o">.</span><span class="n">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">1.0</span>  
 
        <span class="k">if</span> <span class="n">lcheckdef</span><span class="p">:</span>           
            <span class="k">for</span> <span class="n">box</span><span class="p">,(</span><span class="n">des</span><span class="p">,</span><span class="n">var</span><span class="p">,</span><span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">wchecklist</span><span class="p">,</span><span class="n">checkdef</span><span class="p">):</span>
                <span class="n">mulstart</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">current_per</span><span class="p">,</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">box</span><span class="o">.</span><span class="n">value</span>

        <span class="c1">#with out:</span>
        <span class="n">clear_output</span><span class="p">()</span>
        <span class="n">mul</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">mulstart</span><span class="p">,</span><span class="o">**</span><span class="n">modelopt</span><span class="p">)</span>
        <span class="c1"># model.mulstart=mulstart</span>


        <span class="n">clear_output</span><span class="p">()</span>
        <span class="n">display</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
        <span class="c1">#_ = mfrbus[&#39;XGDPN RFF RFFMIN GFSRPN&#39;].dif.rename(trans).plot(colrow=1,sharey=0)</span>
        
        
        <span class="k">if</span> <span class="n">firstrun</span><span class="p">:</span>
            <span class="n">model</span><span class="o">.</span><span class="n">experiment_results</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">model</span><span class="o">.</span><span class="n">experiment_results</span><span class="p">[</span><span class="n">basename</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;results&#39;</span><span class="p">:</span><span class="n">model</span><span class="o">.</span><span class="n">lastdf</span><span class="o">.</span><span class="n">copy</span><span class="p">()}</span>
            <span class="n">firstrun</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">wname</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">altname</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">altname</span> <span class="o">=</span> <span class="n">wname</span><span class="o">.</span><span class="n">value</span>
            <span class="n">walt</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">altname</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">model</span><span class="o">.</span><span class="n">experiment_results</span><span class="p">[</span><span class="n">altname</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;results&#39;</span><span class="p">:</span><span class="n">model</span><span class="o">.</span><span class="n">lastdf</span><span class="o">.</span><span class="n">copy</span><span class="p">()}</span>

        
        <span class="k">if</span> <span class="n">showout</span><span class="p">:</span>
            <span class="n">varpat_this</span> <span class="o">=</span>  <span class="n">wpat</span><span class="o">.</span><span class="n">value</span>
            <span class="n">resdic</span> <span class="o">=</span> <span class="n">get_alt_dic</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">varpat_this</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">experiment_results</span><span class="p">)</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">jupviz</span><span class="p">(</span><span class="n">resdic</span><span class="p">,</span><span class="n">trans</span><span class="o">=</span><span class="n">trans</span><span class="p">)()</span>
        <span class="k">else</span><span class="p">:</span>  
            <span class="n">a</span> <span class="o">=</span> <span class="n">vis_alt4</span><span class="p">(</span><span class="n">get_alt_dic</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">wpat</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">experiment_results</span><span class="p">),</span><span class="n">model</span><span class="p">,</span><span class="n">trans</span><span class="o">=</span><span class="n">trans</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">lslidedef</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">des</span><span class="p">,</span><span class="n">cont</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">slidedef</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">wset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>  <span class="o">=</span>   <span class="n">cont</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
            
        <span class="k">if</span> <span class="n">lradiodef</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">wradio</span> <span class="ow">in</span> <span class="n">wradiolist</span><span class="p">:</span>
                <span class="n">wradio</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
            
        <span class="k">if</span> <span class="n">lcheckdef</span><span class="p">:</span>           
            <span class="k">for</span> <span class="n">box</span><span class="p">,(</span><span class="n">des</span><span class="p">,</span><span class="n">var</span><span class="p">,</span><span class="n">defvalue</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">wchecklist</span><span class="p">,</span><span class="n">checkdef</span><span class="p">):</span>
                <span class="n">box</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">defvalue</span>
                
    <span class="k">def</span> <span class="nf">zeroset</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
        <span class="n">basename</span> <span class="o">=</span> <span class="n">base1name</span> <span class="k">if</span> <span class="n">base1name</span> <span class="k">else</span> <span class="s1">&#39;Baseline&#39;</span> 
        <span class="n">walt</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">altname</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">wbas</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">basename</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">if</span> <span class="n">lslidedef</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">des</span><span class="p">,</span><span class="n">cont</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">slidedef</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">wset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>  <span class="o">=</span>   <span class="nb">type</span><span class="p">(</span><span class="n">cont</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])(</span><span class="mf">0.0</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">lradiodef</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">wradio</span> <span class="ow">in</span> <span class="n">wradiolist</span><span class="p">:</span>
                <span class="n">wradio</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
            
        <span class="k">if</span> <span class="n">lcheckdef</span><span class="p">:</span>           
            <span class="k">for</span> <span class="n">box</span><span class="p">,(</span><span class="n">des</span><span class="p">,</span><span class="n">var</span><span class="p">,</span><span class="n">defvalue</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">wchecklist</span><span class="p">,</span><span class="n">checkdef</span><span class="p">):</span>
                <span class="n">box</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">defvalue</span>


                

    <span class="k">def</span> <span class="nf">setbas</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
        <span class="k">nonlocal</span> <span class="n">basename</span>
        <span class="k">nonlocal</span> <span class="n">firstrun</span> 
        <span class="n">model</span><span class="o">.</span><span class="n">basedf</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">lastdf</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">basename</span> <span class="o">=</span> <span class="n">wname</span><span class="o">.</span><span class="n">value</span>
        <span class="n">walt</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">altname</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">wbas</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">basename</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">wname</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">basename</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">model</span><span class="o">.</span><span class="n">rundic</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">firstrun</span> <span class="o">=</span> <span class="kc">True</span> 
        
        <span class="k">if</span> <span class="n">lslidedef</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">des</span><span class="p">,</span><span class="n">cont</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">slidedef</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="n">waltval</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">=</span>  <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cont</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">&lt;,.</span><span class="si">{</span><span class="n">cont</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dec&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">f</span><span class="si">}</span><span class="s2">&quot;</span>
                
        <span class="k">if</span> <span class="n">lradiodef</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">wradio</span> <span class="ow">in</span> <span class="n">wradiolist</span><span class="p">:</span>
                <span class="n">wradio</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
                
        <span class="k">if</span> <span class="n">lcheckdef</span><span class="p">:</span>           
            <span class="k">for</span> <span class="n">box</span><span class="p">,(</span><span class="n">des</span><span class="p">,</span><span class="n">var</span><span class="p">,</span><span class="n">defvalue</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">wchecklist</span><span class="p">,</span><span class="n">checkdef</span><span class="p">):</span>
                <span class="n">box</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">defvalue</span>


    <span class="c1"># Assign the function to the button  </span>
    <span class="n">wgo</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>
    <span class="n">wreset</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">reset</span><span class="p">)</span>
    <span class="n">wzero</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">zeroset</span><span class="p">)</span>
    <span class="n">wsetbas</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">setbas</span><span class="p">)</span>
    <span class="c1"># out = widgets.Output()</span>
    
    
    <span class="k">if</span> <span class="n">go_now</span><span class="p">:</span>
        <span class="n">run</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">w</span></div>





<div class="viewcode-block" id="get_att_gui"><a class="viewcode-back" href="../jupyter/modeljupyter.html#modeljupyter.get_att_gui">[docs]</a><span class="k">def</span> <span class="nf">get_att_gui</span><span class="p">(</span><span class="n">totdif</span><span class="p">,</span><span class="n">var</span><span class="o">=</span><span class="s1">&#39;FY&#39;</span><span class="p">,</span><span class="n">spat</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="n">desdic</span><span class="o">=</span><span class="p">{},</span><span class="n">use</span><span class="o">=</span><span class="s1">&#39;level&#39;</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span><span class="n">perselect</span><span class="o">=</span><span class="s1">&#39;per&#39;</span><span class="p">,</span><span class="n">ysize</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Creates a jupyter ipywidget to display model level </span>
<span class="sd">    attributions &#39;&#39;&#39;</span> 
    <span class="n">xvar</span><span class="o">=</span><span class="n">var</span>
    <span class="c1"># print(f&#39;{var=}  {xvar}&#39;)</span>
    <span class="k">def</span> <span class="nf">show_all2</span><span class="p">(</span><span class="n">Variable</span><span class="p">,</span><span class="n">Periode</span><span class="p">,</span><span class="n">Save</span><span class="p">,</span><span class="n">Use</span><span class="p">):</span>
         <span class="c1"># global fig1,fig2</span>
         <span class="n">fig1</span> <span class="o">=</span> <span class="n">totdif</span><span class="o">.</span><span class="n">totexplain</span><span class="p">(</span><span class="n">pat</span><span class="o">=</span><span class="n">Variable</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="mf">0.87</span><span class="p">,</span><span class="n">use</span><span class="o">=</span><span class="n">Use</span><span class="p">,</span><span class="n">axvline</span><span class="o">=</span><span class="n">Periode</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">)</span>
         <span class="n">fig2</span> <span class="o">=</span> <span class="n">totdif</span><span class="o">.</span><span class="n">totexplain</span><span class="p">(</span><span class="n">pat</span><span class="o">=</span><span class="n">Variable</span><span class="p">,</span><span class="n">vtype</span><span class="o">=</span><span class="s1">&#39;per&#39;</span><span class="p">,</span><span class="n">per</span> <span class="o">=</span> <span class="n">Periode</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span><span class="n">use</span><span class="o">=</span><span class="n">Use</span><span class="p">,</span><span class="n">ysize</span><span class="o">=</span><span class="n">ysize</span><span class="p">)</span> 
         <span class="k">if</span> <span class="n">Save</span><span class="p">:</span>
            <span class="n">fig1</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attribution-</span><span class="si">{</span><span class="n">Variable</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">use</span><span class="si">}</span><span class="s1">.pdf&#39;</span><span class="p">)</span>
            <span class="n">fig2</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attribution-</span><span class="si">{</span><span class="n">Variable</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">Periode</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">use</span><span class="si">}</span><span class="s1">.pdf&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attribution-</span><span class="si">{</span><span class="n">Variable</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">use</span><span class="si">}</span><span class="s1">.pdf and Attribution-</span><span class="si">{</span><span class="n">Variable</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">Periode</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">use</span><span class="si">}</span><span class="s1">.pdf aare saved&#39;</span> <span class="p">)</span>
    <span class="n">show</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">interactive</span><span class="p">(</span><span class="n">show_all2</span><span class="p">,</span>
              <span class="n">Variable</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">totdif</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endogene</span><span class="p">),</span><span class="n">value</span><span class="o">=</span><span class="n">xvar</span><span class="p">),</span>
              <span class="n">Periode</span>  <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span> <span class="o">=</span> <span class="n">totdif</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_per</span><span class="p">)</span> <span class="k">if</span> <span class="n">perselect</span><span class="o">==</span><span class="s1">&#39;per&#39;</span>
                                          <span class="k">else</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">month</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">day</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">totdif</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_per</span><span class="p">],</span>
              <span class="n">Use</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">RadioButtons</span><span class="p">(</span><span class="n">options</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="s1">&#39;growth&#39;</span><span class="p">],</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Use&#39;</span><span class="p">),</span>
              <span class="n">Save</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Save the charts&#39;</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
              <span class="p">)</span>
    <span class="k">return</span> <span class="n">show</span> </div>

<div class="viewcode-block" id="get_att_gui2"><a class="viewcode-back" href="../jupyter/modeljupyter.html#modeljupyter.get_att_gui2">[docs]</a><span class="k">def</span> <span class="nf">get_att_gui2</span><span class="p">(</span><span class="n">totdif</span><span class="p">,</span><span class="n">var</span><span class="o">=</span><span class="s1">&#39;RP&#39;</span><span class="p">,</span><span class="n">spat</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="n">desdic</span><span class="o">=</span><span class="p">{},</span><span class="n">use</span><span class="o">=</span><span class="s1">&#39;level&#39;</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Creates a jupyter ipywidget to display model level </span>
<span class="sd">    attributions for datily dates &#39;&#39;&#39;</span> 
    <span class="k">def</span> <span class="nf">show_all2</span><span class="p">(</span><span class="n">Variable</span><span class="p">,</span><span class="n">Periode</span><span class="p">,</span><span class="n">Save</span><span class="p">,</span><span class="n">Use</span><span class="p">):</span>
         <span class="k">global</span> <span class="n">fig1</span><span class="p">,</span><span class="n">fig2</span>
         <span class="n">fig1</span> <span class="o">=</span> <span class="n">totdif</span><span class="o">.</span><span class="n">explain_all</span><span class="p">(</span><span class="n">pat</span><span class="o">=</span><span class="n">Variable</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="mf">0.87</span><span class="p">,</span><span class="n">use</span><span class="o">=</span><span class="n">Use</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span><span class="n">stacked</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">axvline</span><span class="o">=</span><span class="n">Periode</span><span class="p">,</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">resample</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">)</span>
         <span class="n">fig2</span> <span class="o">=</span> <span class="n">totdif</span><span class="o">.</span><span class="n">totexplain</span><span class="p">(</span><span class="n">pat</span><span class="o">=</span><span class="n">Variable</span><span class="p">,</span><span class="n">vtype</span><span class="o">=</span><span class="s1">&#39;per&#39;</span><span class="p">,</span><span class="n">per</span> <span class="o">=</span> <span class="n">Periode</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span><span class="n">use</span><span class="o">=</span><span class="n">Use</span><span class="p">,</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span> 
         <span class="k">if</span> <span class="n">Save</span><span class="p">:</span>
            <span class="n">fig1</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attribution-</span><span class="si">{</span><span class="n">Variable</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">use</span><span class="si">}</span><span class="s1">.pdf&#39;</span><span class="p">)</span>
            <span class="n">fig2</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attribution-</span><span class="si">{</span><span class="n">Variable</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">Periode</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">use</span><span class="si">}</span><span class="s1">.pdf&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Attribution-</span><span class="si">{</span><span class="n">Variable</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">use</span><span class="si">}</span><span class="s1">.pdf and Attribution-</span><span class="si">{</span><span class="n">Variable</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">Periode</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">use</span><span class="si">}</span><span class="s1">.pdf aare saved&#39;</span> <span class="p">)</span>

    <span class="n">show</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">interactive</span><span class="p">(</span><span class="n">show_all2</span><span class="p">,</span>
              <span class="n">Variable</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">totdif</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endogene</span><span class="p">),</span><span class="n">value</span><span class="o">=</span><span class="n">var</span><span class="p">),</span>
              <span class="n">Periode</span>  <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">month</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">day</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">mddm</span><span class="o">.</span><span class="n">totdekomp</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">current_per</span><span class="p">]),</span>
              <span class="n">Use</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">RadioButtons</span><span class="p">(</span><span class="n">options</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="s1">&#39;growth&#39;</span><span class="p">],</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Use&#39;</span><span class="p">),</span>
              <span class="n">Save</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Save the charts&#39;</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
              <span class="p">)</span>
    <span class="k">return</span> <span class="n">show</span> </div>

<div class="viewcode-block" id="vtol"><a class="viewcode-back" href="../jupyter/modeljupyter.html#modeljupyter.vtol">[docs]</a><span class="k">def</span> <span class="nf">vtol</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; replaces special characters in variable name to latex&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">var</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;\_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;{&#39;</span><span class="p">,</span><span class="s1">&#39;\{&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">,</span><span class="s1">&#39;\}&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="an_expression_to_latex"><a class="viewcode-back" href="../jupyter/modeljupyter.html#modeljupyter.an_expression_to_latex">[docs]</a><span class="k">def</span> <span class="nf">an_expression_to_latex</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span><span class="n">funks</span><span class="o">=</span><span class="p">[]):</span>
    <span class="sd">&#39;&#39;&#39; Returns a latex string from a list of terms (defined in the modelpattern module)</span>
<span class="sd">    </span>
<span class="sd">    funks is a list of localy defines functions</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">t_to_latex</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">var</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span><span class="n">vtol</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">var</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">lag</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">_</span><span class="se">{{</span><span class="s1">t</span><span class="si">{</span><span class="n">t</span><span class="o">.</span><span class="n">lag</span><span class="si">}</span><span class="se">}}</span><span class="s1">&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">_t&#39;</span>
        <span class="k">elif</span> <span class="n">t</span><span class="o">.</span><span class="n">number</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">number</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span>
                <span class="n">op</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\times&#39;</span>
            <span class="k">elif</span> <span class="n">t</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="s1">&#39;$&#39;</span><span class="p">:</span>
                <span class="n">op</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">op</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">op</span>
            <span class="k">return</span> <span class="n">op</span>

    <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">t_to_latex</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">pt</span><span class="o">.</span><span class="n">udtryk_parse</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span><span class="n">funks</span><span class="o">=</span><span class="n">funks</span><span class="p">)])</span></div>
    
<div class="viewcode-block" id="expressions_to_latex"><a class="viewcode-back" href="../jupyter/modeljupyter.html#modeljupyter.expressions_to_latex">[docs]</a><span class="k">def</span> <span class="nf">expressions_to_latex</span><span class="p">(</span><span class="n">expressions</span><span class="p">,</span><span class="n">funks</span><span class="o">=</span><span class="p">[],</span><span class="n">allign</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">disp</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Returns a latex string from a list of a list of terms</span>
<span class="sd">    </span>
<span class="sd">    :funks: a list of local functions in the model </span>
<span class="sd">    :allign: the first = is enclosed in &amp; for alligning several equations in latex</span>
<span class="sd">    :disp: the result is displayed </span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">texp</span> <span class="o">=</span> <span class="n">expressions</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">expressions</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="k">else</span> <span class="p">[</span><span class="n">expressions</span> <span class="p">]</span>
    <span class="n">latex_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">an_expression_to_latex</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span><span class="n">funks</span><span class="o">=</span><span class="n">funks</span><span class="p">)</span> <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span>  <span class="n">texp</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">allign</span><span class="p">:</span> 
        <span class="n">latex_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="s1">&#39; &amp; = &amp; &#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">latex_list</span><span class="p">]</span>
    <span class="n">latex_out</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">latex_list</span><span class="p">)</span> 
    <span class="n">latex_out</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;\begin{eqnarray*}&#39;</span><span class="o">+</span><span class="n">latex_out</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;\end{eqnarray*}&#39;</span>
    
    <span class="k">if</span> <span class="n">disp</span><span class="p">:</span>
        <span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="o">+</span><span class="n">latex_out</span><span class="o">+</span><span class="s1">&#39;$&#39;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">latex_out</span></div>
    
<div class="viewcode-block" id="frml_as_latex"><a class="viewcode-back" href="../jupyter/modeljupyter.html#modeljupyter.frml_as_latex">[docs]</a><span class="k">def</span> <span class="nf">frml_as_latex</span><span class="p">(</span><span class="n">frml_in</span><span class="p">,</span><span class="n">funks</span><span class="o">=</span><span class="p">[],</span><span class="n">allign</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">disp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">linespace</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Display formula</span>
<span class="sd">    </span>
<span class="sd">    :funks: local functions </span>
<span class="sd">    :allign: allign =</span>
<span class="sd">    :name: also display the frml name</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">frmls</span> <span class="o">=</span>    <span class="n">frml_in</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">frml_in</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="k">else</span> <span class="p">[</span><span class="n">frml_in</span> <span class="p">]</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">frml</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">frmls</span><span class="p">):</span>
        <span class="n">a</span><span class="p">,</span><span class="n">fr</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">udtryk</span><span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">split_frml</span><span class="p">(</span><span class="n">frml</span><span class="p">)</span>
        <span class="n">out_udtryk</span> <span class="o">=</span> <span class="n">an_expression_to_latex</span><span class="p">(</span><span class="n">udtryk</span><span class="p">,</span><span class="n">funks</span> <span class="o">=</span> <span class="n">funks</span><span class="p">)</span>
        <span class="n">out_frmlname</span> <span class="o">=</span> <span class="n">vtol</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">!=</span> <span class="s1">&#39;&lt;&gt;&#39;</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">allign</span><span class="p">:</span>
            <span class="n">out_udtryk</span> <span class="o">=</span> <span class="n">out_udtryk</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="s1">&#39; &amp; = &amp; &#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">[1em]&#39;</span> <span class="k">if</span> <span class="n">linespace</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">out_frmlname</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">out_udtryk</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">latex_out</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">allign</span><span class="p">:</span>
        <span class="n">latex_out</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;\begin{eqnarray*}&#39;</span><span class="o">+</span><span class="n">latex_out</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;\end{eqnarray*}&#39;</span>
    
    <span class="k">if</span> <span class="n">disp</span><span class="p">:</span>
        <span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="o">+</span><span class="n">latex_out</span><span class="o">+</span><span class="s1">&#39;$&#39;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="k">return</span> <span class="n">latex_out</span></div>

<div class="viewcode-block" id="get_frml_latex"><a class="viewcode-back" href="../jupyter/modeljupyter.html#modeljupyter.get_frml_latex">[docs]</a><span class="k">def</span> <span class="nf">get_frml_latex</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">pat</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    
    <span class="n">variabler</span> <span class="o">=</span>  <span class="p">[</span><span class="n">var</span> <span class="k">for</span>  <span class="n">p</span> <span class="ow">in</span> <span class="n">pat</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">nrorder</span><span class="p">,</span><span class="n">p</span><span class="p">)]</span>
    <span class="n">frmls</span> <span class="o">=</span> <span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">allvar</span><span class="p">[</span><span class="n">var</span><span class="p">][</span><span class="s1">&#39;frml&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variabler</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">model</span><span class="o">.</span><span class="n">allvar</span><span class="p">[</span><span class="n">var</span><span class="p">][</span><span class="s1">&#39;dropfrml&#39;</span><span class="p">]]</span>
    <span class="n">_</span><span class="o">=</span><span class="n">frml_as_latex</span><span class="p">(</span><span class="n">frmls</span><span class="p">,</span><span class="n">funks</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">funks</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span></div>
    
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Ib Hansen.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>